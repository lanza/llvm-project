# This file is licensed under the Apache License v2.0 with LLVM Exceptions.
# See https://llvm.org/LICENSE.txt for license information.
# SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception

load("@bazel_skylib//rules:expand_template.bzl", "expand_template")
load("@//build_defs:defs.bzl", "llvm_library", "llvm_binary")
load("@//build_defs:fat_binary.bzl", "fat_binary_alias")
load("@//exports_files.bzl", "exports_files")
load("@//vars.bzl", "LLVM_VERSION_MAJOR", "LLVM_VERSION_MINOR", "LLVM_VERSION_PATCH", "PACKAGE_VERSION")
load("@//mlir:tblgen.bzl", "gentbl_cc_library", "td_library")
load(":config.bzl", "llvm_config_defines")
load(":driver.bzl", "generate_driver_tools_def", "llvm_driver_cc_binary", "select_driver_tools")
load(":enum_targets_gen.bzl", "enum_targets_gen")
load(":targets.bzl", "llvm_targets")

exports_files([
    "LICENSE.TXT",
    "cmake/modules/llvm-driver-template.cpp.in",
    "include/llvm/CodeGen/SDNodeProperties.td",
    "include/llvm/CodeGen/ValueTypes.td",
    "include/llvm/BinaryFormat/Dwarf.def",
    "include/llvm/Frontend/Directive/DirectiveBase.td",
    "include/llvm/Frontend/OpenACC/ACC.td",
    "include/llvm/Frontend/OpenMP/OMP.td",
    "include/llvm/IR/Intrinsics.td",
    "include/llvm/Option/OptParser.td",
    "utils/lit/lit.py",
])

enum_targets_gen(
    name = "targets_def_gen",
    src = "include/llvm/Config/Targets.def.in",
    out = "include/llvm/Config/Targets.def",
    macro_name = "TARGET",
    targets = llvm_targets,
)

# Enabled targets with ASM printers.
llvm_target_asm_printers = [
    t
    for t in llvm_targets
    if glob(["lib/Target/{}/*AsmPrinter.cpp".format(t)])
]

enum_targets_gen(
    name = "asm_printers_def_gen",
    src = "include/llvm/Config/AsmPrinters.def.in",
    out = "include/llvm/Config/AsmPrinters.def",
    macro_name = "ASM_PRINTER",
    targets = llvm_target_asm_printers,
)

# Enabled targets with ASM parsers.
llvm_target_asm_parsers = [
    t
    for t in llvm_targets
    if glob(
        ["lib/Target/{}/AsmParser/CMakeLists.txt".format(t)],
    )
]

enum_targets_gen(
    name = "asm_parsers_def_gen",
    src = "include/llvm/Config/AsmParsers.def.in",
    out = "include/llvm/Config/AsmParsers.def",
    macro_name = "ASM_PARSER",
    targets = llvm_target_asm_parsers,
)

# Enabled targets with disassemblers.
llvm_target_disassemblers = [
    t
    for t in llvm_targets
    if glob(
        ["lib/Target/{}/Disassembler/CMakeLists.txt".format(t)],
    )
]

enum_targets_gen(
    name = "disassemblers_def_gen",
    src = "include/llvm/Config/Disassemblers.def.in",
    out = "include/llvm/Config/Disassemblers.def",
    macro_name = "DISASSEMBLER",
    targets = llvm_target_disassemblers,
)

# Enabled targets with MCA.
llvm_target_mcas = [
    t
    for t in llvm_targets
    if glob(
        ["lib/Target/{}/MCA/CMakeLists.txt".format(t)],
    )
]

enum_targets_gen(
    name = "target_mca_def_gen",
    src = "include/llvm/Config/TargetMCAs.def.in",
    out = "include/llvm/Config/TargetMCAs.def",
    macro_name = "TARGETMCA",
    targets = llvm_target_mcas,
)

# Enabled targets with exegesis.
llvm_target_exegesis = [
    t
    for t in llvm_targets
    if glob(
        ["tools/llvm-exegesis/lib/{}/CMakeLists.txt".format(t)],
    )
]

enum_targets_gen(
    name = "target_exegesis_def_gen",
    src = "include/llvm/Config/TargetExegesis.def.in",
    out = "include/llvm/Config/TargetExegesis.def",
    macro_name = "EXEGESIS",
    placeholder_name = "@LLVM_ENUM_EXEGESIS@",
    targets = llvm_target_exegesis,
)

expand_template(
    name = "abi_breaking_h_gen",
    out = "include/llvm/Config/abi-breaking.h",
    substitutions = {
        # Define to enable checks that alter the LLVM C++ ABI
        "#cmakedefine01 LLVM_ENABLE_ABI_BREAKING_CHECKS": "#define LLVM_ENABLE_ABI_BREAKING_CHECKS 0",

        # Define to enable reverse iteration of unordered llvm containers
        "#cmakedefine01 LLVM_ENABLE_REVERSE_ITERATION": "#define LLVM_ENABLE_REVERSE_ITERATION 0",
    },
    template = "include/llvm/Config/abi-breaking.h.cmake",
)

config_h_stub = """#pragma once
#ifndef LLVM_BUCK2_CONFIG_STUB
#define LLVM_BUCK2_CONFIG_STUB
/* Placeholder config generated by Buck2. Feature checks are not available. */
#endif
"""

llvm_config_h_template = """#pragma once
#define LLVM_VERSION_MAJOR {major}
#define LLVM_VERSION_MINOR {minor}
#define LLVM_VERSION_PATCH {patch}
#define LLVM_VERSION_STRING "{version}"
"""

llvm_config_h_contents = llvm_config_h_template.format(
    major = LLVM_VERSION_MAJOR,
    minor = LLVM_VERSION_MINOR,
    patch = LLVM_VERSION_PATCH,
    version = PACKAGE_VERSION,
)

targets_h_template = """#ifndef LLVM_CONFIG_TARGETS_H
#define LLVM_CONFIG_TARGETS_H
{body}
#endif
"""

targets_h_contents = targets_h_template.format(
    body = "\n".join([
        "#define LLVM_HAS_{target}_TARGET 1".format(target = target_name)
        for target_name in llvm_targets
    ]),
)

native.genrule(
    name = "config_h_stub",
    out = "include/llvm/Config/config.h",
    cmd = "cat <<'EOF' > $OUT\n{}\nEOF".format(config_h_stub),
)

native.genrule(
    name = "llvm_config_stub",
    out = "include/llvm/Config/llvm-config.h",
    cmd = "cat <<'EOF' > $OUT\n{}\nEOF".format(llvm_config_h_contents),
)

native.genrule(
    name = "targets_h_gen",
    out = "include/llvm/Config/Targets.h",
    cmd = "cat <<'EOF' > $OUT\n{}\nEOF".format(targets_h_contents),
)

td_library(
    name = "OptParserTdFiles",
    srcs = ["include/llvm/Option/OptParser.td"],
    includes = ["include"],
)

llvm_config_target_defines = [
    "-DLLVM_HAS_{}_TARGET=1".format(t)
    for t in llvm_targets
]

llvm_library(
    name = "config",
    header_namespace = "",
    exported_headers = {
        "llvm/Config/AsmParsers.def": ":asm_parsers_def_gen",
        "llvm/Config/AsmPrinters.def": ":asm_printers_def_gen",
        "llvm/Config/Disassemblers.def": ":disassemblers_def_gen",
        "llvm/Config/TargetExegesis.def": ":target_exegesis_def_gen",
        "llvm/Config/TargetMCAs.def": ":target_mca_def_gen",
        "llvm/Config/Targets.def": ":targets_def_gen",
        "llvm/Config/Targets.h": ":targets_h_gen",
        "llvm/Config/abi-breaking.h": ":abi_breaking_h_gen",
        # Needed for include scanner to find execinfo.h
        "llvm/Config/config.h": ":config_h_stub",
        "llvm/Config/llvm-config.h": ":llvm_config_stub",
    },
    public_include_directories = ["include"],
    exported_preprocessor_flags = llvm_config_defines + llvm_config_target_defines,
    visibility = ["PUBLIC"],
)

llvm_library(
    name = "Demangle",
    srcs = glob([
        "lib/Demangle/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Demangle/*.h",
        "include/llvm/Demangle/*.def",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [":config"],
)

native.genrule(
    name = "generate_vcs_revision",
    out = "include/llvm/Support/VCSRevision.h",
    cmd = "echo '#undef LLVM_REVISION' >> $OUT\n" +
          "echo '#undef LLVM_REPOSITORY' >> $OUT\n",
)

llvm_library(
    name = "vcs_revision_gen",
    header_namespace = "",
    exported_headers = {
        "llvm/Support/VCSRevision.h": ":generate_vcs_revision",
    },
)

native.genrule(
    name = "generate_static_extension_registry",
    out = "include/llvm/Support/Extension.def",
    cmd = "echo -e '// extension handlers' >> $OUT\n" +
          "echo -e '#undef HANDLE_EXTENSION' >> $OUT\n",
)

llvm_library(
    name = "static_extension_registry_gen",
    header_namespace = "",
    exported_headers = {
        "llvm/Support/Extension.def": ":generate_static_extension_registry",
    },
)

llvm_library(
    name = "Support",
    srcs = glob([
        "lib/Support/*.c",
        "lib/Support/*.cpp",
    ]) + [
        "lib/Support/BLAKE3/blake3.c",
        "lib/Support/BLAKE3/blake3_dispatch.c",
        "lib/Support/BLAKE3/blake3_portable.c",
    ] + select({
        "DEFAULT": [],
        "prelude//cpu:arm64": [
            "lib/Support/BLAKE3/blake3_neon.c",
        ],
        "prelude//cpu:x86_64": [
            "lib/Support/BLAKE3/blake3_avx2_x86-64_unix.S",
            "lib/Support/BLAKE3/blake3_avx512_x86-64_unix.S",
            "lib/Support/BLAKE3/blake3_sse2_x86-64_unix.S",
            "lib/Support/BLAKE3/blake3_sse41_x86-64_unix.S",
        ],
    }),
    raw_headers = glob([
        "include/llvm/Support/**/*.h",
        "include/llvm/ADT/*.h",
        "lib/Support/*.h",
        "lib/Support/*.inc",
        # To avoid a dependency cycle.
        "include/llvm/Option/*.h",
        "include/llvm/Support/*.def",
    ]) + [
        "include/llvm-c/Core.h",
        "include/llvm-c/DataTypes.h",
        "include/llvm-c/Deprecated.h",
        "include/llvm-c/DisassemblerTypes.h",
        "include/llvm-c/Error.h",
        "include/llvm-c/ErrorHandling.h",
        "include/llvm-c/ExternC.h",
        "include/llvm-c/Support.h",
        "include/llvm-c/Types.h",
        "include/llvm-c/blake3.h",
        "include/llvm/ExecutionEngine/JITSymbol.h",
        "lib/Support/BLAKE3/blake3_impl.h",
        "lib/Support/BLAKE3/llvm_blake3_prefix.h",
    ] + select({
        "DEFAULT": glob([
            "lib/Support/Unix/*.h",
            "lib/Support/Unix/*.inc",
        ]),
        "prelude//os:windows": glob([
            "lib/Support/Windows/*.inc",
        ]),
    }),
    exported_linker_flags = select({
        "DEFAULT": [
            "-pthread",
            "-ldl",
            "-lm",
        ],
        "prelude//os:freebsd": [
            "-pthread",
            "-lexecinfo",
            "-ldl",
            "-lm",
        ],
        "prelude//os:macos": [
            "-pthread",
            "-ldl",
        ],
        "prelude//os:windows": [
            "ws2_32.lib",
            "ntdll.lib",
        ],
    }),
    preprocessor_flags = select({
        "DEFAULT": [
            "-DBLAKE3_USE_NEON=0",
        ],
        "prelude//cpu:arm64": [
        ],
    }) + select({
        "DEFAULT": [
            "-DBLAKE3_NO_AVX2",
            "-DBLAKE3_NO_AVX512",
            "-DBLAKE3_NO_SSE2",
            "-DBLAKE3_NO_SSE41",
        ],
        "prelude//cpu:x86_64": [
        ],
    }),
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
        "-fexceptions",
        "-frtti",
    ],
    public_include_directories = [
        "include",
        "../third-party/siphash/include",
    ],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":config",
        ":Demangle",
        # We unconditionally depend on the custom LLVM zlib wrapper. This will
        # be an empty library unless zlib is enabled, in which case it will
        # both provide the necessary dependencies and configuration defines.
        "//third-party/zlib:z",
        ":vcs_revision_gen",
        ":static_extension_registry_gen",
    ],
)

# Note: although FileCheck (the binary) is a test utility, some non-test
# targets depend on the FileCheck library target.
llvm_library(
    name = "FileCheckLib",
    srcs = glob([
        "lib/FileCheck/*.cpp",
    ]),
    raw_headers = glob([
        "lib/FileCheck/*.h",
        "include/llvm/FileCheck/*.h",
    ]),
    exported_deps = [":Support"],
)

llvm_library(
    name = "Option",
    srcs = glob([
        "lib/Option/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Option/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
        ":config",
    ],
)

llvm_library(
    name = "TableGen",
    srcs = glob([
        "lib/TableGen/*.cpp",
    ]),
    raw_headers = glob([
        "lib/TableGen/*.h",
        "include/llvm/TableGen/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
        ":config",
    ],
)

# This exists to avoid circular dependencies.
llvm_library(
    name = "ir_headers",
    raw_headers = glob(
        [
            "include/llvm/*.h",
            "include/llvm/IR/*.h",
        ],
        exclude = [
            "include/llvm/LinkAllPasses.h",
        ],
    ) + [
        "include/llvm-c/Comdat.h",
        "include/llvm-c/DebugInfo.h",
        "include/llvm/IR/Value.def",
    ],
)

llvm_library(
    name = "BinaryFormat",
    srcs = glob([
        "lib/BinaryFormat/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/BinaryFormat/*.h",
        "include/llvm/BinaryFormat/*.def",
        "include/llvm/BinaryFormat/ELFRelocs/*.def",
    ]),
    exported_preprocessor_flags = [
        "-Wno-deprecated-anon-enum-enum-conversion",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "DebugInfo",
    raw_headers = glob(["include/llvm/DebugInfo/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Object",
        ":Support",
    ],
)

llvm_library(
    name = "DebugInfoMSF",
    srcs = glob([
        "lib/DebugInfo/MSF/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/MSF/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [":Support"],
)

llvm_library(
    name = "DebugInfoBTF",
    srcs = glob([
        "lib/DebugInfo/BTF/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/BTF/*.h",
    ]) + [
        "include/llvm/DebugInfo/BTF/BTF.def",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":DebugInfo",
        ":Object",
        ":Support",
    ],
)

llvm_library(
    name = "DebugInfoCodeView",
    srcs = glob([
        "lib/DebugInfo/CodeView/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/CodeView/*.h",
        "include/llvm/DebugInfo/CodeView/*.def",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfoMSF",
        ":Support",
    ],
)

llvm_library(
    name = "DebugInfoLogicalView",
    srcs = glob([
        "lib/DebugInfo/LogicalView/**/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/LogicalView/**/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfo",
        ":DebugInfoCodeView",
        ":DebugInfoDWARF",
        ":DebugInfoPDB",
        ":Demangle",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":Support",
    ],
)

llvm_library(
    name = "DebugInfoPDB",
    srcs = glob([
        "lib/DebugInfo/PDB/*.cpp",
        "lib/DebugInfo/PDB/Native/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/PDB/*.h",
        "include/llvm/DebugInfo/PDB/Native/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfo",
        ":DebugInfoBTF",
        ":DebugInfoCodeView",
        ":DebugInfoMSF",
        ":Object",
        ":Support",
        ":config",
    ],
)

llvm_library(
    name = "Debuginfod",
    srcs = glob([
        "lib/Debuginfod/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Debuginfod/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfoDWARF",
        ":Object",
        ":Support",
        ":Symbolize",
    ],
)

llvm_library(
    name = "MC",
    srcs = glob([
        "lib/MC/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/MC/*.h",
        "include/llvm/MIP/*.h",
        "include/llvm/MIP/*.inc",
        "include/llvm/DebugInfo/DIContext.h",
        "include/llvm/Object/*.h"
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfoCodeView",
        ":MIP", # Gator Specific
        ":Support",
        ":TargetParser",
        ":config",
        ":ir_headers",
    ],
)

llvm_library(
    name = "DebugInfoDWARF",
    srcs = glob([
        "lib/DebugInfo/DWARF/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/DWARF/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfo",
        ":DebugInfoDWARFLowLevel",
        ":MC",
        ":Object",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "DebugInfoDWARFLowLevel",
    srcs = glob([
        "lib/DebugInfo/DWARF/LowLevel/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/DWARF/LowLevel/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "DebugInfoGSYM",
    srcs = glob([
        "lib/DebugInfo/GSYM/*.cpp",
    ]),
    raw_headers = glob(["include/llvm/DebugInfo/GSYM/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":DebugInfo",
        ":DebugInfoDWARF",
        ":MC",
        ":Object",
        ":Support",
    ],
)

llvm_library(
    name = "Symbolize",
    srcs = glob([
        "lib/DebugInfo/Symbolize/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/DebugInfo/Symbolize/*.h",
        "include/llvm/Debuginfod/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfo",
        ":DebugInfoBTF",
        ":DebugInfoDWARF",
        ":DebugInfoPDB",
        ":Demangle",
        ":Object",
        ":Support",
        ":TargetParser",
    ],
)

# Implement minimal support for llvm-config, which will only output the correct values for arguments
# which are needed by LLD's test suite.
expand_template(
    name = "build_variables_inc_gen",
    out = "BuildVariables.inc",
    substitutions = {
        "@BUILD_SHARED_LIBS@": "0",
        "@LLVM_BUILD_LLVM_DYLIB@": "0",
        "@LLVM_LINK_LLVM_DYLIB@": "0",
        "@LLVM_HAS_RTTI@": "0",
        "@LLVM_TARGETS_BUILT@": " ".join(llvm_targets),
    },
    template = "tools/llvm-config/BuildVariables.inc.in",
)

# See llvm/cmake/modules/LLVM-Build.cmake
library_dependencies_stub = """
struct AvailableComponent {
  /// The name of the component.
  const char *Name;

  /// The name of the library for this component (or NULL).
  const char *Library;

  /// Whether the component is installed.
  bool IsInstalled;

  /// The list of libraries required when linking this component.
  const char *RequiredLibraries[];
} AvailableComponents[] = {};
"""

native.genrule(
    name = "library_dependencies_inc_gen",
    cmd = 'echo "{}" > $OUT'.format(library_dependencies_stub),
    out = "LibraryDependencies.inc",
)

# See llvm/cmake/modules/AddLLVM.cmake
extension_dependencies_stub = """
#include <array>
struct ExtensionDescriptor {
  const char* Name;
  const char* RequiredLibraries[];
};
std::array<ExtensionDescriptor, 0> AvailableExtensions{};
"""

native.genrule(
    name = "extension_dependencies_inc_gen",
    cmd = 'echo "{}" > $OUT'.format(extension_dependencies_stub),
    out = "ExtensionDependencies.inc",
)

llvm_binary(
    name = "llvm-config",
    srcs = glob(["tools/llvm-config/*.cpp"]),
    headers = {
        "BuildVariables.inc": ":build_variables_inc_gen",
        "ExtensionDependencies.inc": ":extension_dependencies_inc_gen",
        "LibraryDependencies.inc": ":library_dependencies_inc_gen",
    },
    header_namespace = "",
    visibility = ["PUBLIC"],
    deps = [
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

generate_driver_tools_def(
    name = "gen_llvm_driver_tools_def",
    out = "LLVMDriverTools.def",
    driver_tools = select_driver_tools("driver-tools"),
)

llvm_library(
    name = "llvm_driver_tools_def_lib",
    public_include_directories = ["."],
    exported_headers = {"LLVMDriverTools.def": ":gen_llvm_driver_tools_def",},
    visibility = ["PUBLIC"],
    compiler_flags = ["-Wno-error=header-hygiene", "-Wno-error=unused-but-set-variable"],
    header_namespace = "",
)

llvm_binary(
    name = "llvm",
    srcs = glob(["tools/llvm-driver/*.cpp"]),
    deps = [
        ":Support",
        ":llvm_driver_tools_def_lib",
    ] + select_driver_tools("driver-tools"),
    visibility = ["PUBLIC"],
    compiler_flags = ["-Wno-error=header-hygiene", "-Wno-error=unused-but-set-variable"],
)

llvm_binary(
    name = "llvm-min-tblgen-bin",
    srcs = [
        "utils/TableGen/Basic/ARMTargetDefEmitter.cpp",
        "utils/TableGen/Basic/Attributes.cpp",
        "utils/TableGen/Basic/CodeGenIntrinsics.cpp",
        "utils/TableGen/Basic/DirectiveEmitter.cpp",
        "utils/TableGen/Basic/IntrinsicEmitter.cpp",
        "utils/TableGen/Basic/RuntimeLibcallsEmitter.cpp",
        "utils/TableGen/Basic/RISCVTargetDefEmitter.cpp",
        "utils/TableGen/Basic/TargetFeaturesEmitter.cpp",
        "utils/TableGen/Basic/SDNodeProperties.cpp",
        "utils/TableGen/Basic/TableGen.cpp",
        "utils/TableGen/Basic/VTEmitter.cpp",
        "utils/TableGen/llvm-min-tblgen.cpp",
    ],
    headers = [
        "utils/TableGen/Basic/CodeGenIntrinsics.h",
        "utils/TableGen/Basic/SDNodeProperties.h",
        "utils/TableGen/Basic/TableGen.h",
        "utils/TableGen/Basic/SequenceToOffsetTable.h",
    ],
    deps = [
        ":Support",
        ":TableGen",
        ":config",
    ],
)

fat_binary_alias(
    name = "llvm-min-tblgen",
    bin = ":llvm-min-tblgen-bin",
)

llvm_library(
    name = "TableGenGlobalISel",
    srcs = [
        "utils/TableGen/Common/GlobalISel/CodeExpander.cpp",
    ],
    raw_headers = [
        # We have to include these headers here as well as in the `hdrs` below
        # to allow the `.cpp` files to use file-relative-inclusion to find
        # them, even though consumers of this library use inclusion relative to
        # `utils/TableGen` with the `strip_includes_prefix` of this library.
        # This mixture appears to be incompatible with header modules.
        "utils/TableGen/Common/GlobalISel/CodeExpander.h",
        "utils/TableGen/Common/GlobalISel/CodeExpansions.h",
    ],
    public_include_directories = ["utils/TableGen"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":CodeGenTypes",
        ":Support",
        ":TableGen",
        ":config",
    ],
)

llvm_library(
    name = "llvm-tblgen-headers",
    header_namespace = "",
    raw_headers = glob(["utils/TableGen/*.def"]),
)

llvm_binary(
    name = "llvm-tblgen-bin",
    srcs = glob(
        [
            "utils/TableGen/*.cpp",
            "utils/TableGen/Basic/*.cpp",
            "utils/TableGen/Common/*.cpp",
            "utils/TableGen/Common/GlobalISel/*.cpp",
        ],
        exclude = [
            "utils/TableGen/Common/GlobalISel/CodeExpander.cpp",
            "utils/TableGen/llvm-min-tblgen.cpp",
        ],
    ),
    headers = glob([
        "utils/TableGen/*.h",
        "utils/TableGen/Basic/*.h",
        "utils/TableGen/Common/*.h",
        "utils/TableGen/Common/GlobalISel/*.h",

        # Some tablegen sources include headers from MC, so these have to be
        # listed here. MC uses headers produced by tablegen, so it cannot be a
        # regular dependency.
        "include/llvm/MC/*.h",
    ]) + [
        "include/llvm/TargetParser/SubtargetFeature.h",
    ],
    include_directories = ["utils/TableGen"],
    visibility = ["PUBLIC"],
    deps = [
        ":CodeGenTypes",
        ":Support",
        ":TableGen",
        ":TableGenGlobalISel",
        ":TargetParser",
        ":config",
        ":llvm-tblgen-headers",
        ":vt_gen",
        "//third-party/siphash:siphash",
    ],
)

fat_binary_alias(
    name = "llvm-tblgen",
    bin = ":llvm-tblgen-bin",
    visibility = ["PUBLIC"],
)

gentbl_cc_library(
    name = "intrinsic_enums_gen",
    tbl_outs = [(
        ["-gen-intrinsic-enums"],
        "include/llvm/IR/IntrinsicEnums.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/IR/Intrinsics.td",
    deps = [":CommonTargetTdFiles"],
)

gentbl_cc_library(
    name = "intrinsics_impl_gen",
    tbl_outs = [(
        ["-gen-intrinsic-impl"],
        "include/llvm/IR/IntrinsicImpl.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/IR/Intrinsics.td",
    deps = [":CommonTargetTdFiles"],
)

gentbl_cc_library(
    name = "vt_gen",
    tbl_outs = [(
        ["-gen-vt"],
        "include/llvm/CodeGen/GenVT.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/CodeGen/ValueTypes.td",
)

gentbl_cc_library(
    name = "runtime_libcalls_gen",
    tbl_outs = [(
        ["-gen-runtime-libcalls"],
        "include/llvm/IR/RuntimeLibcalls.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/IR/RuntimeLibcalls.td",
    includes = ["include"],
    deps = [
        ":IRTdFiles",
        ":CommonTargetTdFiles",
    ],
)

# Note that the intrinsics are not currently set up so they can be pruned for
# disabled targets.
llvm_target_intrinsics_list = [
    {
        "name": "AArch64",
        "intrinsic_prefix": "aarch64",
    },
    {
        "name": "AMDGPU",
        "intrinsic_prefix": "amdgcn",
    },
    {
        "name": "ARM",
        "intrinsic_prefix": "arm",
    },
    {
        "name": "BPF",
        "intrinsic_prefix": "bpf",
    },
    {
        "name": "DirectX",
        "intrinsic_prefix": "dx",
    },
    {
        "name": "Hexagon",
        "intrinsic_prefix": "hexagon",
    },
    {
        "name": "LoongArch",
        "intrinsic_prefix": "loongarch",
    },
    {
        "name": "Mips",
        "intrinsic_prefix": "mips",
    },
    {
        "name": "NVPTX",
        "intrinsic_prefix": "nvvm",
    },
    {
        "name": "PowerPC",
        "intrinsic_prefix": "ppc",
    },
    {
        "name": "R600",
        "intrinsic_prefix": "r600",
    },
    {
        "name": "RISCV",
        "intrinsic_prefix": "riscv",
    },
    {
        "name": "S390",
        "intrinsic_prefix": "s390",
    },
    {
        "name": "SPIRV",
        "intrinsic_prefix": "spv",
    },
    {
        "name": "VE",
        "intrinsic_prefix": "ve",
    },
    {
        "name": "WebAssembly",
        "intrinsic_prefix": "wasm",
    },
    {
        "name": "X86",
        "intrinsic_prefix": "x86",
    },
    {
        "name": "XCore",
        "intrinsic_prefix": "xcore",
    },
]

[[
    gentbl_cc_library(
        name = "intrinsic_" + target["name"] + "_gen",
        includes = ["include"],
        tbl_outs = [(
            [
                "-gen-intrinsic-enums",
                "-intrinsic-prefix=" + target["intrinsic_prefix"],
            ],
            "include/llvm/IR/Intrinsics" + target["name"] + ".h",
        )],
        tblgen = ":llvm-min-tblgen",
        td_file = "include/llvm/IR/Intrinsics.td",
        deps = [
            ":CodegenTdFiles",
            ":IRTdFiles",
        ],
    ),
] for target in llvm_target_intrinsics_list]

gentbl_cc_library(
    name = "attributes_gen",
    tbl_outs = [(
        ["-gen-attrs"],
        "include/llvm/IR/Attributes.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/IR/Attributes.td",
)

llvm_library(
    name = "BitstreamReader",
    srcs = glob([
        "lib/Bitstream/Reader/*.cpp",
    ]),
    raw_headers = [
        "include/llvm/Bitstream/BitCodeEnums.h",
        "include/llvm/Bitstream/BitCodes.h",
        "include/llvm/Bitstream/BitstreamReader.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
    ],
)

llvm_library(
    name = "BitstreamWriter",
    raw_headers = [
        "include/llvm/Bitstream/BitCodeEnums.h",
        "include/llvm/Bitstream/BitCodes.h",
        "include/llvm/Bitstream/BitstreamWriter.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
    ],
)

llvm_library(
    name = "Remarks",
    srcs = glob(
        [
            "lib/Remarks/*.cpp",
        ],
        exclude = ["lib/Remarks/RemarkLinker.cpp"],
    ),
    raw_headers = glob(
        [
            "include/llvm/Remarks/*.h",
            "lib/Remarks/*.h",
        ],
        exclude = ["include/llvm/Remarks/RemarkLinker.h"],
    ) + [
        "include/llvm-c/Remarks.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BitstreamReader",
        ":BitstreamWriter",
        ":Support",
    ],
)

llvm_library(
    name = "remark_linker",
    srcs = ["lib/Remarks/RemarkLinker.cpp"],
    raw_headers = ["include/llvm/Remarks/RemarkLinker.h"],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Object",
        ":Remarks",
        ":Support",
    ],
)

# META: Directly inlined into Core
# filegroup(
#     name = "llvm_intrinsics_headers",
#     srcs = [
#         "include/llvm/IR/Intrinsics" + target["name"] + ".h"
#         for target in llvm_target_intrinsics_list
#     ],
# )

llvm_library(
    name = "Core",
    srcs = glob([
        "lib/IR/*.cpp",
    ]),
    raw_headers = glob(
        [
            "include/llvm/*.h",
            "include/llvm/IR/*.h",
            "include/llvm/IR/*.def",
            "lib/IR/*.h",
        ],
        exclude = [
            "include/llvm/LinkAllPasses.h",
        ],
    ) + [
        "include/llvm-c/Comdat.h",
        "include/llvm-c/DebugInfo.h",
        "include/llvm/Analysis/SimplifyQuery.h",
        "include/llvm/Analysis/ValueTracking.h",
        "include/llvm/Analysis/WithCache.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":Demangle",
        ":Remarks",
        ":Support",
        ":TargetParser",
        ":attributes_gen",
        ":config",
        ":intrinsic_enums_gen",
        ":intrinsics_impl_gen",
        ":runtime_libcalls_gen",
    ] + [
        # :llvm_intrinsics_headers
        ":intrinsic_" + target["name"] + "_gen"
        for target in llvm_target_intrinsics_list
    ],
)

llvm_library(
    name = "BitReader",
    srcs = glob([
        "lib/Bitcode/Reader/*.cpp",
    ]),
    raw_headers = [
        "include/llvm-c/BitReader.h",
        "include/llvm/Bitcode/BitcodeAnalyzer.h",
        "include/llvm/Bitcode/BitcodeCommon.h",
        "include/llvm/Bitcode/BitcodeReader.h",
        "include/llvm/Bitcode/LLVMBitCodes.h",
    ] + glob([
        "lib/Bitcode/Reader/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":BitstreamReader",
        ":Core",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "MCParser",
    srcs = glob([
        "lib/MC/MCParser/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/MC/MCParser/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfoCodeView",
        ":MC",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "Telemetry",
    srcs = glob(["lib/Telemetry/*.cpp"]),
    raw_headers = glob(["include/llvm/Telemetry/*.h"]),
    public_include_directories = ["include"],
    exported_deps = [
        ":Support",
    ],
)

llvm_library(
    name = "TextAPI",
    srcs = glob(
        [
            "lib/TextAPI/**/*.cpp",
        ],
        exclude = ["lib/TextAPI/BinaryReader/**"],
    ),
    raw_headers = glob(
        [
            "include/llvm/TextAPI/**/*.h",
            "include/llvm/TextAPI/**/*.def",
            "lib/TextAPI/**/*.h",
        ],
        exclude = [
            "lib/TextAPI/BinaryReader/**",
            "include/llvm/TextAPI/DylibReader.h",
        ],
    ),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "TextAPIBinaryReader",
    srcs = glob([
        "lib/TextAPI/BinaryReader/**/*.cpp",
    ]),
    raw_headers = ["include/llvm/TextAPI/DylibReader.h"],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":DebugInfoDWARF",
        ":Object",
        ":Support",
        ":TargetParser",
        ":TextAPI",
    ],
)

llvm_library(
    name = "ObjCopy",
    srcs = glob([
        "lib/ObjCopy/**/*.cpp",
    ]),
    raw_headers = glob([
        "lib/ObjCopy/**/*.h",
        "include/llvm/ObjCopy/**/*.h",
    ]),
    visibility = ["PUBLIC"],
    public_include_directories = ["include", "lib/ObjCopy"],
    exported_deps = [
        ":BinaryFormat",
        ":MC",
        ":Object",
        ":ObjectYAML",
        ":Option",
        ":Support",
        ":Target",
        ":intrinsics_impl_gen",
    ],
)

llvm_library(
    name = "Object",
    srcs = glob([
        "lib/Object/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Object/*.h",
        "lib/Object/*.h",
    ]) + [
        "include/llvm-c/Object.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":BitReader",
        ":Core",
        ":IRReader",
        ":MC",
        ":MCParser",
        ":Support",
        ":TargetParser",
        ":TextAPI",
        ":config",
    ],
)

llvm_library(
    name = "ObjectYAML",
    srcs = glob([
        "lib/ObjectYAML/*.cpp",
    ]),
    raw_headers = glob(["include/llvm/ObjectYAML/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfoCodeView",
        ":MC",
        ":Object",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "ProfileData",
    srcs = glob([
        "lib/ProfileData/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ProfileData/*.h",
        "include/llvm/ProfileData/*.inc",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BitstreamReader",
        ":BitstreamWriter",
        ":Core",
        ":DebugInfo",
        ":DebugInfoDWARF",
        ":Demangle",
        ":Object",
        ":Support",
        ":Symbolize",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "Coverage",
    srcs = glob([
        "lib/ProfileData/Coverage/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ProfileData/Coverage/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":Object",
        ":ProfileData",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "Analysis",
    srcs = glob(
        [
            "lib/Analysis/*.cpp",
        ],
    ),
    raw_headers = glob(
        [
            "include/llvm/Analysis/*.h",
            "include/llvm/Analysis/Utils/*.h",
            "include/llvm/Analysis/*.def",
            "include/llvm/Transforms/Utils/ModuleUtils.h",
        ],
    ) + [
        "include/llvm-c/Analysis.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":Core",
        ":Object",
        ":ProfileData",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "BitWriter",
    srcs = glob([
        "lib/Bitcode/Writer/*.cpp",
    ]),
    raw_headers = [
        "include/llvm-c/BitWriter.h",
        "include/llvm/Bitcode/BitcodeCommon.h",
        "include/llvm/Bitcode/BitcodeConvenience.h",
        "include/llvm/Bitcode/BitcodeWriter.h",
        "include/llvm/Bitcode/BitcodeWriterPass.h",
        "include/llvm/Bitcode/LLVMBitCodes.h",
    ] + glob([
        "lib/Bitcode/Writer/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":BitReader",
        ":BitstreamWriter",
        ":Core",
        ":MC",
        ":Object",
        ":ProfileData",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "Target",
    srcs = glob([
        "lib/Target/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Target/*.h",
    ]) + [
        "include/llvm-c/Target.h",
        "include/llvm-c/TargetMachine.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":BinaryFormat",
        ":Core",
        ":MC",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

# META: Directly inlined into CommonTargetTdFiles
# filegroup(
#     name = "common_target_td_sources",
#     srcs = glob([
#         "include/llvm/CodeGen/*.td",
#         "include/llvm/Frontend/Directive/*.td",
#         "include/llvm/IR/Intrinsics*.td",
#         "include/llvm/TableGen/*.td",
#         "include/llvm/Target/*.td",
#         "include/llvm/Target/GlobalISel/*.td",
#     ]),
# )

td_library(
    name = "CodegenTdFiles",
    srcs = glob(["include/llvm/CodeGen/*.td"]),
    includes = ["include"],
)

td_library(
    name = "IRTdFiles",
    srcs = glob(["include/llvm/IR/*.td"]),
    includes = ["include"],
)

td_library(
    name = "CommonTargetTdFiles",
    srcs = glob([
        "include/llvm/CodeGen/*.td",
        "include/llvm/Frontend/Directive/*.td",
        "include/llvm/IR/Intrinsics*.td",
        "include/llvm/TableGen/*.td",
        "include/llvm/Target/*.td",
        "include/llvm/Target/GlobalISel/*.td",
    ]),
    includes = ["include"],
)

td_library(
    name = "ArmTargetTdFiles",
    srcs = glob([
        "lib/Target/ARM/**/*.td",
    ]),
    includes = ["lib/Target/ARM"],
)

gentbl_cc_library(
    name = "ARMTargetParserDefGen",
    tbl_outs = [(
        ["-gen-arm-target-def"],
        "include/llvm/TargetParser/ARMTargetParserDef.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "lib/Target/ARM/ARM.td",
    deps = [
        ":ArmTargetTdFiles",
        ":CommonTargetTdFiles",
    ],
)

td_library(
    name = "AArch64TargetTdFiles",
    srcs = glob([
        "lib/Target/AArch64/**/*.td",
    ]),
    includes = ["lib/Target/AArch64"],
)

gentbl_cc_library(
    name = "AArch64TargetParserDefGen",
    tbl_outs = [(
        ["-gen-arm-target-def"],
        "include/llvm/TargetParser/AArch64TargetParserDef.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "lib/Target/AArch64/AArch64.td",
    deps = [
        ":AArch64TargetTdFiles",
        ":CommonTargetTdFiles",
    ],
)

td_library(
    name = "RISCVTargetTdFiles",
    srcs = glob([
        "lib/Target/RISCV/**/*.td",
    ]),
    includes = ["lib/Target/RISCV"],
)

td_library(
    name = "PPCTargetTdFiles",
    srcs = glob([
        "lib/Target/PowerPC/**/*.td",
    ]),
    includes = ["lib/Target/PowerPC"],
)

gentbl_cc_library(
    name = "RISCVTargetParserDefGen",
    tbl_outs = [(
        ["-gen-riscv-target-def"],
        "include/llvm/TargetParser/RISCVTargetParserDef.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "lib/Target/RISCV/RISCV.td",
    deps = [
        ":CommonTargetTdFiles",
        ":RISCVTargetTdFiles",
    ],
)

gentbl_cc_library(
    name = "PPCGenTargetFeaturesGen",
    tbl_outs = [(
        ["-gen-target-features"],
        "include/llvm/TargetParser/PPCGenTargetFeatures.inc",
    )],
    tblgen = ":llvm-min-tblgen",
    td_file = "lib/Target/PowerPC/PPC.td",
    deps = [
        ":CommonTargetTdFiles",
        ":PPCTargetTdFiles",
    ],
)

llvm_library(
    name = "TargetParser",
    srcs = glob([
        "lib/TargetParser/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/TargetParser/*.h",
        "include/llvm/TargetParser/*.def",
    ]) + [
        "include/llvm/TargetParser/AArch64CPUFeatures.inc",
        "include/llvm/TargetParser/AArch64FeatPriorities.inc",
    ] + select({
        "DEFAULT": glob([
            "lib/TargetParser/Unix/*.inc",
        ]),
        "prelude//os:windows": glob([
            "lib/TargetParser/Windows/*.inc",
        ]),
    }),
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":PPCGenTargetFeaturesGen",
        ":AArch64TargetParserDefGen",
        ":ARMTargetParserDefGen",
        ":RISCVTargetParserDefGen",
        ":Support",
        ":config",
    ],
)

llvm_library(
    name = "DWP",
    srcs = glob([
        "lib/DWP/*.cpp",
    ]),
    raw_headers = glob(["include/llvm/DWP/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":DebugInfoDWARF",
        ":MC",
        ":Object",
        ":Support",
        ":Target",
    ],
)

llvm_library(
    name = "TransformUtils",
    srcs = glob([
        "lib/Transforms/Utils/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Transforms/Utils/*.h",
    ]) + [
        "include/llvm/Transforms/Utils.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":BinaryFormat",
        ":BitWriter",
        ":Core",
        ":ProfileData",
        ":Support",
        ":Target",
        ":TargetParser",
        ":config",
    ],
)

td_library(
    name = "AMDGPUTargetTdFiles",
    srcs = glob([
        "lib/Target/AMDGPU/**/*.td",
    ]),
    includes = ["lib/Target/AMDGPU"],
)

gentbl_cc_library(
    name = "InstCombineTableGen",
    strip_include_prefix = "lib/Target/AMDGPU",
    tbl_outs = [(
        ["-gen-searchable-tables"],
        "lib/Target/AMDGPU/InstCombineTables.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "lib/Target/AMDGPU/InstCombineTables.td",
    deps = [
        ":AMDGPUTargetTdFiles",
        ":CommonTargetTdFiles",
    ],
)

llvm_library(
    name = "InstCombine",
    srcs = glob([
        "lib/Transforms/InstCombine/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Transforms/InstCombine/*.h",
        "lib/Transforms/InstCombine/*.h",
    ]),
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":Support",
        ":Target",
        ":TransformUtils",
        ":config",
    ],
)

llvm_library(
    name = "AggressiveInstCombine",
    srcs = glob([
        "lib/Transforms/AggressiveInstCombine/*.cpp",
    ]),
    raw_headers = [
        "include/llvm/Transforms/AggressiveInstCombine/AggressiveInstCombine.h",
    ] + glob([
        "lib/Transforms/AggressiveInstCombine/*.h",
    ]),
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":Support",
        ":TransformUtils",
    ],
)

llvm_library(
    name = "Instrumentation",
    srcs = glob([
        "lib/Transforms/Instrumentation/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Transforms/Instrumentation/*.h",
        "lib/Transforms/Instrumentation/*.h",
        "lib/Transforms/Instrumentation/*.inc",
    ]) + [
        "include/llvm/Transforms/Utils/Instrumentation.h",
    ],
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":BinaryFormat",
        ":Core",
        ":Demangle",
        ":MC",
        ":ProfileData",
        ":Scalar",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":config",
    ],
)

llvm_library(
    name = "ObjCARC",
    srcs = glob([
        "lib/Transforms/ObjCARC/*.cpp",
    ]),
    raw_headers = ["include/llvm/Transforms/ObjCARC.h"] + glob([
        "lib/Transforms/ObjCARC/*.h",
    ]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":Support",
        ":Target",
        ":TransformUtils",
        ":config",
    ],
)

llvm_library(
    name = "SandboxIR",
    srcs = glob([
        "lib/SandboxIR/*.cpp",
    ]),
    raw_headers = glob(["include/llvm/SandboxIR/*.h"]) + ["include/llvm/SandboxIR/Values.def"],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":Support",
    ],
)

llvm_library(
    name = "Scalar",
    srcs = glob([
        "lib/Transforms/Scalar/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Transforms/Scalar/*.h",
    ]) + [
        "include/llvm/Transforms/Scalar.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AggressiveInstCombine",
        ":Analysis",
        ":BinaryFormat",
        ":Core",
        ":InstCombine",
        ":ProfileData",
        ":Support",
        ":Target",
        ":TransformUtils",
        ":config",
    ],
)

llvm_library(
    name = "Vectorize",
    srcs = glob([
        "lib/Transforms/Vectorize/**/*.cpp",
    ]),
    raw_headers = glob([
        "lib/Transforms/Vectorize/**/*.h",
        "include/llvm/Transforms/Vectorize/**/*.h",
        "lib/Transforms/Vectorize/SandboxVectorizer/Passes/PassRegistry.def",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":SandboxIR",
        ":Scalar",
        ":Support",
        ":Target",
        ":TransformUtils",
        ":config",
    ],
)

llvm_library(
    name = "FrontendDebug",
    raw_headers = glob([
        "include/llvm/Frontend/Debug/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
    ],
)

llvm_library(
    name = "FrontendDriver",
    srcs = glob([
        "lib/Frontend/Driver/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Frontend/Driver/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":TargetParser",
    ],
)

llvm_library(
    name = "FrontendHLSL",
    srcs = glob([
        "lib/Frontend/HLSL/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Frontend/HLSL/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Core",
        ":Support",
    ],
)

llvm_library(
    name = "FrontendOffloading",
    srcs = glob([
        "lib/Frontend/Offloading/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Frontend/Offloading/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":Core",
        ":Object",
        ":Support",
        ":TargetParser",
        ":TransformUtils",
    ],
)

llvm_library(
    name = "FrontendDirective",
    srcs = glob([
        "lib/Frontend/Directive/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Frontend/Directive/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
    ],
)

llvm_library(
    name = "FrontendOpenACC",
    srcs = glob([
        "lib/Frontend/OpenACC/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Frontend/OpenACC/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":FrontendDirective",
        ":Support",
        ":TransformUtils",
        ":acc_gen",
        ":acc_gen_impl",
    ],
    deps = [
        ":acc_gen",
        ":acc_gen_impl",
    ],
)

td_library(
    name = "OmpTdFiles",
    srcs = glob([
        "include/llvm/Frontend/OpenMP/*.td",
        "include/llvm/Frontend/Directive/*.td",
    ]),
    includes = ["include"],
)

gentbl_cc_library(
    name = "omp_gen",
    tbl_outs = [
        (
            ["--gen-directive-decl"],
            "include/llvm/Frontend/OpenMP/OMP.h.inc",
        ),
    ],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/Frontend/OpenMP/OMP.td",
    deps = [":OmpTdFiles"],
)

gentbl_cc_library(
    name = "omp_gen_impl",
    tbl_outs = [
        (
            ["--gen-directive-impl"],
            "include/llvm/Frontend/OpenMP/OMP.inc",
        ),
    ],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/Frontend/OpenMP/OMP.td",
    deps = [":OmpTdFiles"],
)

llvm_library(
    name = "FrontendAtomic",
    srcs = glob([
        "lib/Frontend/Atomic/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Frontend/Atomic/*.h",
    ]),
    exported_deps = [
        ":Core",
        ":Support",
    ],
)

llvm_library(
    name = "FrontendOpenMP",
    srcs = glob([
        "lib/Frontend/OpenMP/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Frontend/OpenMP/*.h",
        "include/llvm/Frontend/OpenMP/*.def",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":BitReader",
        ":Core",
        ":Demangle",
        ":FrontendAtomic",
        ":FrontendOffloading",
        ":MC",
        ":Scalar",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":omp_gen",
        ":omp_gen_impl",
    ],
)

td_library(
    name = "AccTdFiles",
    srcs = glob([
        "include/llvm/Frontend/OpenACC/*.td",
        "include/llvm/Frontend/Directive/*.td",
    ]),
    includes = ["include"],
)

gentbl_cc_library(
    name = "acc_gen",
    tbl_outs = [
        (
            ["--gen-directive-decl"],
            "include/llvm/Frontend/OpenACC/ACC.h.inc",
        ),
    ],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/Frontend/OpenACC/ACC.td",
    deps = [":AccTdFiles"],
)

gentbl_cc_library(
    name = "acc_gen_impl",
    tbl_outs = [
        (
            ["--gen-directive-impl"],
            "include/llvm/Frontend/OpenACC/ACC.inc",
        ),
    ],
    tblgen = ":llvm-min-tblgen",
    td_file = "include/llvm/Frontend/OpenACC/ACC.td",
    deps = [":AccTdFiles"],
)

llvm_library(
    name = "AsmParser",
    srcs = glob([
        "lib/AsmParser/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/AsmParser/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":Core",
        ":Support",
        ":attributes_gen",
    ],
)

llvm_library(
    name = "IRPrinter",
    srcs = glob([
        "lib/IRPrinter/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/IRPrinter/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":Support",
    ],
)

llvm_library(
    name = "IRReader",
    srcs = glob([
        "lib/IRReader/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/IRReader/*.h",
    ]) + [
        "include/llvm-c/IRReader.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AsmParser",
        ":BitReader",
        ":Core",
        ":Support",
        ":config",
    ],
)

llvm_library(
    name = "Linker",
    srcs = glob([
        "lib/Linker/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Linker/*.h",
        "lib/Linker/*.h",
    ]) + [
        "include/llvm-c/Linker.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Core",
        ":Object",
        ":Support",
        ":TargetParser",
        ":TransformUtils",
        ":config",
    ],
)

llvm_library(
    name = "IPO",
    srcs = glob([
        "lib/Transforms/IPO/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Transforms/IPO/*.h",
    ]) + [
        "include/llvm/Transforms/IPO.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AggressiveInstCombine",
        ":Analysis",
        ":BinaryFormat",
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":FrontendOpenMP",
        ":IRPrinter",
        ":IRReader",
        ":InstCombine",
        ":Instrumentation",
        ":Linker",
        ":ObjCARC",
        ":Object",
        ":ProfileData",
        ":Scalar",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":Vectorize",
        ":config",
        ":ir_headers",
    ],
)

llvm_library(
    name = "CFGuard",
    srcs = glob([
        "lib/Transforms/CFGuard/*.cpp",
    ]),
    raw_headers = ["include/llvm/Transforms/CFGuard.h"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Core",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "HipStdPar",
    srcs = glob([
        "lib/Transforms/HipStdPar/*.cpp",
    ]),
    raw_headers = ["include/llvm/Transforms/HipStdPar/HipStdPar.h"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":Core",
        ":Support",
        ":TargetParser",
        ":TransformUtils",
    ],
)

llvm_library(
    name = "Coroutines",
    srcs = glob([
        "lib/Transforms/Coroutines/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Transforms/Coroutines/*.h",
        "lib/Transforms/Coroutines/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":BinaryFormat",
        ":Core",
        ":IPO",
        ":Scalar",
        ":Support",
        ":TransformUtils",
        ":config",
    ],
)

# Meta-target for clients which depend on all of the transforms libraries.
llvm_library(
    name = "common_transforms",
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AggressiveInstCombine",
        ":CFGuard",
        ":Coroutines",
        ":IPO",
        ":InstCombine",
        ":Instrumentation",
        ":ObjCARC",
        ":Scalar",
        ":Vectorize",
    ],
)

llvm_library(
    name = "asm_printer_defs",
    header_namespace = "",
    raw_headers = glob(["lib/CodeGen/AsmPrinter/*.def"]),
)

llvm_library(
    name = "CodeGenTypes",
    srcs = glob([
        "lib/CodeGenTypes/**/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/CodeGenTypes/**/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
        ":vt_gen",
    ],
)

llvm_library(
    name = "CGData",
    srcs = glob(["lib/CGData/**/*.cpp"]),
    raw_headers = glob([
        "include/llvm/CGData/**/*.h",
        "include/llvm/CGData/**/*.inc",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":Object",
        ":ObjectYAML",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "CodeGen",
    srcs = glob(
        [
            "lib/CodeGen/**/*.cpp",
            "lib/CodeGen/SelectionDAG/*.cpp",
        ],
    ),
    raw_headers = [
        "include/llvm/LinkAllPasses.h",
    ] + glob(
        [
            "include/llvm/CodeGen/**/*.h",
            "lib/CodeGen/**/*.h",
            "lib/CodeGen/SelectionDAG/*.h",
            "include/llvm/CodeGen/**/*.def",
            "include/llvm/MIP/*.h",
            "include/llvm/MIP/*.inc",
        ],
    ),
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
        "-Wno-error=unused-variable",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AggressiveInstCombine",
        ":Analysis",
        ":AsmParser",
        ":BinaryFormat",
        ":BitReader",
        ":BitWriter",
        ":CFGuard",
        ":CGData",
        ":CodeGenTypes",
        ":Core",
        ":DebugInfoCodeView",
        ":DebugInfoDWARF",
        ":IPO",
        ":IRPrinter",
        ":Instrumentation",
        ":MC",
        ":MCParser",
        ":MIP", # Gator Specific
        ":ObjCARC",
        ":Object",
        ":ProfileData",
        ":Remarks",
        ":Scalar",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":asm_printer_defs",
        ":config",
        ":vt_gen",
    ],
)

llvm_library(
    name = "MCDisassembler",
    srcs = glob([
        "lib/MC/MCDisassembler/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/MC/MCDisassembler/*.h",
        "lib/MC/MCDisassembler/*.h",
    ]) + [
        "include/llvm-c/Disassembler.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":MC",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_target_lib_list = [lib for lib in [
    {
        "name": "AArch64",
        "short_name": "AArch64",
        "tbl_outs": [
            (
                ["-gen-register-bank"],
                "lib/Target/AArch64/AArch64GenRegisterBank.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/AArch64/AArch64GenRegisterInfo.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/AArch64/AArch64GenInstrInfo.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/AArch64/AArch64GenMCCodeEmitter.inc",
            ),
            (
                ["-gen-pseudo-lowering"],
                "lib/Target/AArch64/AArch64GenMCPseudoLowering.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/AArch64/AArch64GenAsmWriter.inc",
            ),
            (
                [
                    "-gen-asm-writer",
                    "-asmwriternum=1",
                ],
                "lib/Target/AArch64/AArch64GenAsmWriter1.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/AArch64/AArch64GenAsmMatcher.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/AArch64/AArch64GenDAGISel.inc",
            ),
            (
                ["-gen-fast-isel"],
                "lib/Target/AArch64/AArch64GenFastISel.inc",
            ),
            (
                ["-gen-global-isel"],
                "lib/Target/AArch64/AArch64GenGlobalISel.inc",
            ),
            (
                [
                    "-gen-global-isel-combiner",
                    "-combiners=AArch64O0PreLegalizerCombiner",
                ],
                "lib/Target/AArch64/AArch64GenO0PreLegalizeGICombiner.inc",
            ),
            (
                [
                    "-gen-global-isel-combiner",
                    "-combiners=AArch64PreLegalizerCombiner",
                ],
                "lib/Target/AArch64/AArch64GenPreLegalizeGICombiner.inc",
            ),
            (
                [
                    "-gen-global-isel-combiner",
                    "-combiners=AArch64PostLegalizerCombiner",
                ],
                "lib/Target/AArch64/AArch64GenPostLegalizeGICombiner.inc",
            ),
            (
                [
                    "-gen-global-isel-combiner",
                    "-combiners=AArch64PostLegalizerLowering",
                ],
                "lib/Target/AArch64/AArch64GenPostLegalizeGILowering.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/AArch64/AArch64GenCallingConv.inc",
            ),
            (
                ["-gen-sd-node-info"],
                "lib/Target/AArch64/AArch64GenSDNodeInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/AArch64/AArch64GenSubtargetInfo.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/AArch64/AArch64GenDisassemblerTables.inc",
            ),
            (
                ["-gen-searchable-tables"],
                "lib/Target/AArch64/AArch64GenSystemOperands.inc",
            ),
            (
                ["-gen-exegesis"],
                "lib/Target/AArch64/AArch64GenExegesis.inc",
            ),
        ],
    },
    {
        "name": "ARM",
        "short_name": "ARM",
        "tbl_outs": [
            (
                ["-gen-register-bank"],
                "lib/Target/ARM/ARMGenRegisterBank.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/ARM/ARMGenRegisterInfo.inc",
            ),
            (
                ["-gen-searchable-tables"],
                "lib/Target/ARM/ARMGenSystemRegister.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/ARM/ARMGenInstrInfo.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/ARM/ARMGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-pseudo-lowering"],
                "lib/Target/ARM/ARMGenMCPseudoLowering.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/ARM/ARMGenAsmWriter.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/ARM/ARMGenAsmMatcher.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/ARM/ARMGenDAGISel.inc",
            ),
            (
                ["-gen-fast-isel"],
                "lib/Target/ARM/ARMGenFastISel.inc",
            ),
            (
                ["-gen-global-isel"],
                "lib/Target/ARM/ARMGenGlobalISel.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/ARM/ARMGenCallingConv.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/ARM/ARMGenSubtargetInfo.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/ARM/ARMGenDisassemblerTables.inc",
            ),
        ],
    },
    {
        "name": "AMDGPU",
        "short_name": "AMDGPU",
        "tbl_deps": [
            ":InstCombineTableGen",
            ":amdgpu_isel_target_gen",
            ":r600_target_gen",
        ],
        "tbl_outs": [
            (
                ["-gen-register-bank"],
                "lib/Target/AMDGPU/AMDGPUGenRegisterBank.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/AMDGPU/AMDGPUGenRegisterInfo.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/AMDGPU/AMDGPUGenInstrInfo.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/AMDGPU/AMDGPUGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-pseudo-lowering"],
                "lib/Target/AMDGPU/AMDGPUGenMCPseudoLowering.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/AMDGPU/AMDGPUGenAsmWriter.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/AMDGPU/AMDGPUGenAsmMatcher.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/AMDGPU/AMDGPUGenDAGISel.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/AMDGPU/AMDGPUGenCallingConv.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/AMDGPU/AMDGPUGenSubtargetInfo.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/AMDGPU/AMDGPUGenDisassemblerTables.inc",
            ),
            (
                ["-gen-searchable-tables"],
                "lib/Target/AMDGPU/AMDGPUGenSearchableTables.inc",
            ),
        ],
    },
    {
        "name": "AVR",
        "short_name": "AVR",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/AVR/AVRGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/AVR/AVRGenAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/AVR/AVRGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/AVR/AVRGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/AVR/AVRGenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/AVR/AVRGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/AVR/AVRGenInstrInfo.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/AVR/AVRGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/AVR/AVRGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "BPF",
        "short_name": "BPF",
        "tbl_outs": [
            (
                ["-gen-register-bank"],
                "lib/Target/BPF/BPFGenRegisterBank.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/BPF/BPFGenAsmWriter.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/BPF/BPFGenAsmMatcher.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/BPF/BPFGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/BPF/BPFGenDAGISel.inc",
            ),
            (
                ["-gen-global-isel"],
                "lib/Target/BPF/BPFGenGlobalISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/BPF/BPFGenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/BPF/BPFGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/BPF/BPFGenInstrInfo.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/BPF/BPFGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/BPF/BPFGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "Hexagon",
        "short_name": "Hexagon",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/Hexagon/HexagonGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/Hexagon/HexagonGenAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/Hexagon/HexagonGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/Hexagon/HexagonGenDAGISel.inc",
            ),
            (
                ["-gen-dfa-packetizer"],
                "lib/Target/Hexagon/HexagonGenDFAPacketizer.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/Hexagon/HexagonGenDisassemblerTables.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/Hexagon/HexagonGenInstrInfo.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/Hexagon/HexagonGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/Hexagon/HexagonGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/Hexagon/HexagonGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "Lanai",
        "short_name": "Lanai",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/Lanai/LanaiGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/Lanai/LanaiGenAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/Lanai/LanaiGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/Lanai/LanaiGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/Lanai/LanaiGenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/Lanai/LanaiGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/Lanai/LanaiGenInstrInfo.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/Lanai/LanaiGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/Lanai/LanaiGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "LoongArch",
        "short_name": "LoongArch",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/LoongArch/LoongArchGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/LoongArch/LoongArchGenAsmWriter.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/LoongArch/LoongArchGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/LoongArch/LoongArchGenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/LoongArch/LoongArchGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/LoongArch/LoongArchGenInstrInfo.inc",
            ),
            (
                ["-gen-pseudo-lowering"],
                "lib/Target/LoongArch/LoongArchGenMCPseudoLowering.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/LoongArch/LoongArchGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/LoongArch/LoongArchGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "Mips",
        "short_name": "Mips",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/Mips/MipsGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/Mips/MipsGenAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/Mips/MipsGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/Mips/MipsGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/Mips/MipsGenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/Mips/MipsGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-exegesis"],
                "lib/Target/Mips/MipsGenExegesis.inc",
            ),
            (
                ["-gen-fast-isel"],
                "lib/Target/Mips/MipsGenFastISel.inc",
            ),
            (
                ["-gen-global-isel"],
                "lib/Target/Mips/MipsGenGlobalISel.inc",
            ),
            (
                [
                    "-gen-global-isel-combiner",
                    "-combiners=MipsPostLegalizerCombiner",
                ],
                "lib/Target/Mips/MipsGenPostLegalizeGICombiner.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/Mips/MipsGenInstrInfo.inc",
            ),
            (
                ["-gen-pseudo-lowering"],
                "lib/Target/Mips/MipsGenMCPseudoLowering.inc",
            ),
            (
                ["-gen-register-bank"],
                "lib/Target/Mips/MipsGenRegisterBank.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/Mips/MipsGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/Mips/MipsGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "MSP430",
        "short_name": "MSP430",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/MSP430/MSP430GenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/MSP430/MSP430GenAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/MSP430/MSP430GenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/MSP430/MSP430GenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/MSP430/MSP430GenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/MSP430/MSP430GenMCCodeEmitter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/MSP430/MSP430GenInstrInfo.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/MSP430/MSP430GenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/MSP430/MSP430GenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "NVPTX",
        "short_name": "NVPTX",
        "tbl_outs": [
            (
                ["-gen-register-info"],
                "lib/Target/NVPTX/NVPTXGenRegisterInfo.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/NVPTX/NVPTXGenInstrInfo.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/NVPTX/NVPTXGenAsmWriter.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/NVPTX/NVPTXGenDAGISel.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/NVPTX/NVPTXGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "PowerPC",
        "short_name": "PPC",
        "tbl_outs": [
            (
                ["-gen-asm-writer"],
                "lib/Target/PowerPC/PPCGenAsmWriter.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/PowerPC/PPCGenAsmMatcher.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/PowerPC/PPCGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/PowerPC/PPCGenRegisterInfo.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/PowerPC/PPCGenInstrInfo.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/PowerPC/PPCGenDAGISel.inc",
            ),
            (
                ["-gen-fast-isel"],
                "lib/Target/PowerPC/PPCGenFastISel.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/PowerPC/PPCGenCallingConv.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/PowerPC/PPCGenSubtargetInfo.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/PowerPC/PPCGenDisassemblerTables.inc",
            ),
            (
                ["-gen-register-bank"],
                "lib/Target/PowerPC/PPCGenRegisterBank.inc",
            ),
            (
                ["-gen-global-isel"],
                "lib/Target/PowerPC/PPCGenGlobalISel.inc",
            ),
            (
                ["-gen-exegesis"],
                "lib/Target/PowerPC/PPCGenExegesis.inc",
            ),
        ],
    },
    {
        "name": "RISCV",
        "short_name": "RISCV",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/RISCV/RISCVGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/RISCV/RISCVGenAsmWriter.inc",
            ),
            (
                ["-gen-compress-inst-emitter"],
                "lib/Target/RISCV/RISCVGenCompressInstEmitter.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/RISCV/RISCVGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/RISCV/RISCVGenDisassemblerTables.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/RISCV/RISCVGenInstrInfo.inc",
            ),
            (
                ["-gen-macro-fusion-pred"],
                "lib/Target/RISCV/RISCVGenMacroFusion.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/RISCV/RISCVGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-pseudo-lowering"],
                "lib/Target/RISCV/RISCVGenMCPseudoLowering.inc",
            ),
            (
                ["-gen-register-bank"],
                "lib/Target/RISCV/RISCVGenRegisterBank.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/RISCV/RISCVGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/RISCV/RISCVGenSubtargetInfo.inc",
            ),
            (
                ["-gen-searchable-tables"],
                "lib/Target/RISCV/RISCVGenSearchableTables.inc",
            ),
            (
                ["-gen-exegesis"],
                "lib/Target/RISCV/RISCVGenExegesis.inc",
            ),
        ],
        "tbl_deps": [
            ":riscv_isel_target_gen",
        ],
    },
    {
        "name": "Sparc",
        "short_name": "Sparc",
        "tbl_outs": [
            (
                ["-gen-asm-writer"],
                "lib/Target/Sparc/SparcGenAsmWriter.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/Sparc/SparcGenAsmMatcher.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/Sparc/SparcGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/Sparc/SparcGenRegisterInfo.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/Sparc/SparcGenInstrInfo.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/Sparc/SparcGenDAGISel.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/Sparc/SparcGenCallingConv.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/Sparc/SparcGenSubtargetInfo.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/Sparc/SparcGenDisassemblerTables.inc",
            ),
            (
                ["-gen-searchable-tables"],
                "lib/Target/Sparc/SparcGenSearchableTables.inc",
            ),
        ],
    },
    {
        "name": "SPIRV",
        "short_name": "SPIRV",
        "tbl_outs": [
            (
                ["-gen-asm-writer"],
                "lib/Target/SPIRV/SPIRVGenAsmWriter.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/SPIRV/SPIRVGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-global-isel"],
                "lib/Target/SPIRV/SPIRVGenGlobalISel.inc",
            ),
            (
                [
                    "-gen-global-isel-combiner",
                    "-combiners=SPIRVPreLegalizerCombiner",
                ],
                "lib/Target/SPIRV/SPIRVGenPreLegalizeGICombiner.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/SPIRV/SPIRVGenInstrInfo.inc",
            ),
            (
                ["-gen-register-bank"],
                "lib/Target/SPIRV/SPIRVGenRegisterBank.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/SPIRV/SPIRVGenRegisterInfo.inc",
            ),
            (
                ["-gen-searchable-tables"],
                "lib/Target/SPIRV/SPIRVGenTables.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/SPIRV/SPIRVGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "SystemZ",
        "short_name": "SystemZ",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/SystemZ/SystemZGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/SystemZ/SystemZGenGNUAsmWriter.inc",
            ),
            (
                [
                    "-gen-asm-writer",
                    "-asmwriternum=1",
                ],
                "lib/Target/SystemZ/SystemZGenHLASMAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/SystemZ/SystemZGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/SystemZ/SystemZGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/SystemZ/SystemZGenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/SystemZ/SystemZGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/SystemZ/SystemZGenInstrInfo.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/SystemZ/SystemZGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/SystemZ/SystemZGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "VE",
        "short_name": "VE",
        "tbl_outs": [
            (
                ["-gen-asm-matcher"],
                "lib/Target/VE/VEGenAsmMatcher.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/VE/VEGenAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/VE/VEGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/VE/VEGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/VE/VEGenDisassemblerTables.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/VE/VEGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/VE/VEGenInstrInfo.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/VE/VEGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/VE/VEGenSubtargetInfo.inc",
            ),
        ],
    },
    {
        "name": "WebAssembly",
        "short_name": "WebAssembly",
        "tbl_outs": [
            (
                ["-gen-disassembler"],
                "lib/Target/WebAssembly/WebAssemblyGenDisassemblerTables.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/WebAssembly/WebAssemblyGenAsmWriter.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/WebAssembly/WebAssemblyGenInstrInfo.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/WebAssembly/WebAssemblyGenDAGISel.inc",
            ),
            (
                ["-gen-fast-isel"],
                "lib/Target/WebAssembly/WebAssemblyGenFastISel.inc",
            ),
            (
                ["-gen-emitter"],
                "lib/Target/WebAssembly/WebAssemblyGenMCCodeEmitter.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/WebAssembly/WebAssemblyGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/WebAssembly/WebAssemblyGenSubtargetInfo.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/WebAssembly/WebAssemblyGenAsmMatcher.inc",
            ),
        ],
    },
    {
        "name": "X86",
        "short_name": "X86",
        "tbl_outs": [
            (
                ["-gen-register-bank"],
                "lib/Target/X86/X86GenRegisterBank.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/X86/X86GenRegisterInfo.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/X86/X86GenDisassemblerTables.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/X86/X86GenInstrInfo.inc",
            ),
            (
                ["-gen-asm-writer"],
                "lib/Target/X86/X86GenAsmWriter.inc",
            ),
            (
                [
                    "-gen-asm-writer",
                    "-asmwriternum=1",
                ],
                "lib/Target/X86/X86GenAsmWriter1.inc",
            ),
            (
                ["-gen-asm-matcher"],
                "lib/Target/X86/X86GenAsmMatcher.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/X86/X86GenDAGISel.inc",
            ),
            (
                ["-gen-fast-isel"],
                "lib/Target/X86/X86GenFastISel.inc",
            ),
            (
                ["-gen-global-isel"],
                "lib/Target/X86/X86GenGlobalISel.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/X86/X86GenCallingConv.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/X86/X86GenSubtargetInfo.inc",
            ),
            (
                [
                    "-gen-x86-fold-tables",
                    "-asmwriternum=1",
                ],
                "lib/Target/X86/X86GenFoldTables.inc",
            ),
            (
                ["-gen-x86-instr-mapping"],
                "lib/Target/X86/X86GenInstrMapping.inc",
            ),
            (
                ["-gen-exegesis"],
                "lib/Target/X86/X86GenExegesis.inc",
            ),
            (
                [
                    "-gen-x86-mnemonic-tables",
                    "-asmwriternum=1",
                ],
                "lib/Target/X86/X86GenMnemonicTables.inc",
            ),
        ],
    },
    {
        "name": "XCore",
        "short_name": "XCore",
        "tbl_outs": [
            (
                ["-gen-asm-writer"],
                "lib/Target/XCore/XCoreGenAsmWriter.inc",
            ),
            (
                ["-gen-callingconv"],
                "lib/Target/XCore/XCoreGenCallingConv.inc",
            ),
            (
                ["-gen-dag-isel"],
                "lib/Target/XCore/XCoreGenDAGISel.inc",
            ),
            (
                ["-gen-disassembler"],
                "lib/Target/XCore/XCoreGenDisassemblerTables.inc",
            ),
            (
                ["-gen-instr-info"],
                "lib/Target/XCore/XCoreGenInstrInfo.inc",
            ),
            (
                ["-gen-register-info"],
                "lib/Target/XCore/XCoreGenRegisterInfo.inc",
            ),
            (
                ["-gen-subtarget"],
                "lib/Target/XCore/XCoreGenSubtargetInfo.inc",
            ),
        ],
    },
] if lib["name"] in llvm_targets]

gentbl_cc_library(
    name = "amdgpu_isel_target_gen",
    strip_include_prefix = "lib/Target/AMDGPU",
    tbl_outs = [
        (
            ["-gen-global-isel"],
            "lib/Target/AMDGPU/AMDGPUGenGlobalISel.inc",
        ),
        (
            [
                "-gen-global-isel-combiner",
                "-combiners=AMDGPUPreLegalizerCombiner",
            ],
            "lib/Target/AMDGPU/AMDGPUGenPreLegalizeGICombiner.inc",
        ),
        (
            [
                "-gen-global-isel-combiner",
                "-combiners=AMDGPUPostLegalizerCombiner",
            ],
            "lib/Target/AMDGPU/AMDGPUGenPostLegalizeGICombiner.inc",
        ),
        (
            [
                "-gen-global-isel-combiner",
                "-combiners=AMDGPURegBankCombiner",
            ],
            "lib/Target/AMDGPU/AMDGPUGenRegBankGICombiner.inc",
        ),
    ],
    tblgen = ":llvm-tblgen",
    td_file = "lib/Target/AMDGPU/AMDGPUGISel.td",
    deps = [
        ":AMDGPUTargetTdFiles",
        ":CommonTargetTdFiles",
    ],
)

gentbl_cc_library(
    name = "r600_target_gen",
    strip_include_prefix = "lib/Target/AMDGPU",
    tbl_outs = [
        (
            ["-gen-asm-writer"],
            "lib/Target/AMDGPU/R600GenAsmWriter.inc",
        ),
        (
            ["-gen-callingconv"],
            "lib/Target/AMDGPU/R600GenCallingConv.inc",
        ),
        (
            ["-gen-dag-isel"],
            "lib/Target/AMDGPU/R600GenDAGISel.inc",
        ),
        (
            ["-gen-dfa-packetizer"],
            "lib/Target/AMDGPU/R600GenDFAPacketizer.inc",
        ),
        (
            ["-gen-instr-info"],
            "lib/Target/AMDGPU/R600GenInstrInfo.inc",
        ),
        (
            ["-gen-emitter"],
            "lib/Target/AMDGPU/R600GenMCCodeEmitter.inc",
        ),
        (
            ["-gen-register-info"],
            "lib/Target/AMDGPU/R600GenRegisterInfo.inc",
        ),
        (
            ["-gen-subtarget"],
            "lib/Target/AMDGPU/R600GenSubtargetInfo.inc",
        ),
    ],
    tblgen = ":llvm-tblgen",
    td_file = "lib/Target/AMDGPU/R600.td",
    deps = [
        ":AMDGPUTargetTdFiles",
        ":CommonTargetTdFiles",
    ],
)

gentbl_cc_library(
    name = "riscv_isel_target_gen",
    strip_include_prefix = "lib/Target/RISCV",
    tbl_outs = [
        (
            ["-gen-global-isel"],
            "lib/Target/RISCV/RISCVGenGlobalISel.inc",
        ),
        (
            [
                "-gen-global-isel-combiner",
                "-combiners=RISCVO0PreLegalizerCombiner",
            ],
            "lib/Target/RISCV/RISCVGenO0PreLegalizeGICombiner.inc",
        ),
        (
            [
                "-gen-global-isel-combiner",
                "-combiners=RISCVPostLegalizerCombiner",
            ],
            "lib/Target/RISCV/RISCVGenPostLegalizeGICombiner.inc",
        ),
        (
            [
                "-gen-global-isel-combiner",
                "-combiners=RISCVPreLegalizerCombiner",
            ],
            "lib/Target/RISCV/RISCVGenPreLegalizeGICombiner.inc",
        ),
    ],
    tblgen = ":llvm-tblgen",
    td_file = "lib/Target/RISCV/RISCVGISel.td",
    deps = [
        ":CommonTargetTdFiles",
        ":RISCVTargetTdFiles",
    ],
)

[[
    [gentbl_cc_library(
        name = target["name"] + "CommonTableGen",
        strip_include_prefix = "lib/Target/" + target["name"],
        tbl_outs = [(
            # MSVC isn't happy with long string literals, while other compilers
            # which support them get significant compile time improvements with
            # them enabled. Ideally this flag would only be enabled on Windows via
            # a select() on `@platforms//os:windows,`, but that would
            # require refactoring gentbl from a macro into a rule.
            # TODO(#92): Refactor gentbl to support this use
            args
            + (["-ignore-non-decodable-operands"] if "-gen-disassembler" in args and "-ignore-non-decodable-operands" not in args else [])
            + (["--specialize-decoders-per-bitwidth"] if ("-gen-disassembler" in args and "AMDGPU" in out and "--specialize-decoders-per-bitwidth" not in args) else [])
            + (["-ignore-fully-defined-operands"] if ("-gen-disassembler" in args and "AMDGPU" in out and "-ignore-fully-defined-operands" not in args) else [])
            + ["--long-string-literals=0"],
            out,
        ) for (args, out) in target["tbl_outs"]],
        tblgen = ":llvm-tblgen",
        td_file = "lib/Target/" + target["name"] + "/" + target["short_name"] + ".td",
        td_srcs = glob(
            [
                "lib/Target/" + target["name"] + "/*.td",
                "lib/Target/" + target["name"] + "/GISel/*.td",
            ],
        ),
        deps = target.get("tbl_deps", []) + [":CommonTargetTdFiles"],
    )],
    [llvm_library(
        name = target["name"] + "Info",
        srcs = ["lib/Target/" + target["name"] + "/TargetInfo/" + target["name"] + "TargetInfo.cpp"],
        raw_headers = glob(["lib/Target/" + target["name"] + "/TargetInfo/*.h"]),
        # Workaround for https://github.com/bazelbuild/bazel/issues/3828
        # TODO(gcmn): Remove this when upgrading to a Bazel version containing
        # https://github.com/bazelbuild/bazel/commit/e3b7e17b05f1
        public_include_directories = ["lib/Target/" + target["name"]],
        exported_deps = [
            ":" + target["name"] + "CommonTableGen",
            ":MC",
            ":Support",
            ":Target",
        ],
    )],
    # We cannot separate the `Utils` and `MCTargetDesc` sublibraries of
    # a number of targets due to crisscrossing inclusion of headers.
    [llvm_library(
        name = target["name"] + "UtilsAndDesc",
        srcs = glob(
            [
                "lib/Target/" + target["name"] + "/MCTargetDesc/*.cpp",
                "lib/Target/" + target["name"] + "/Utils/*.cpp",
            ],
        ),
        raw_headers = glob(
            [
                "lib/Target/" + target["name"] + "/MCTargetDesc/*.h",
                "lib/Target/" + target["name"] + "/Utils/*.h",

                # This a bit of a hack to allow us to expose common, internal
                # target header files to other libraries within the target via
                # target-relative includes. This usage of headers is inherently
                # non-modular as there is a mixture of target-relative inclusion
                # using this rule and file-relative inclusion using the repeated
                # listing of these headers in the `srcs` of subsequent rules.
                "lib/Target/" + target["name"] + "/*.h",

                # FIXME: The entries below should be `textual_hdrs` instead of
                # `hdrs`, but unfortunately that doesn't work with
                # `strip_include_prefix`:
                # https://github.com/bazelbuild/bazel/issues/12424
                #
                # Once that issue is fixed and released, we can switch this to
                # `textual_hdrs` and remove the feature disabling the various Bazel
                # features (both current and under-development) that motivated the
                # distinction between these two.
                "lib/Target/" + target["name"] + "/*.def",
                "lib/Target/" + target["name"] + "/*.inc",
                "lib/Target/" + target["name"] + "/MCTargetDesc/*.def",
            ],
        ),
        compiler_flags = [
            "-Wno-error=header-hygiene",
            "-Wno-error=unused-but-set-variable",
        ],
        public_include_directories = ["lib/Target/" + target["name"]],
        visibility = ["PUBLIC"],
        exported_deps = [
            ":BinaryFormat",
            ":CodeGen",
            ":CodeGenTypes",
            ":Core",
            ":DebugInfoCodeView",
            ":MC",
            ":MCDisassembler",
            ":Support",
            ":Target",
            ":config",
            ":" + target["name"] + "CommonTableGen",
            ":" + target["name"] + "Info",
        ] + target.get("tbl_deps", []),
    )],
    [llvm_library(
        name = target["name"] + "CodeGen",
        srcs = glob(
            [
                "lib/Target/" + target["name"] + "/GISel/*.cpp",
                "lib/Target/" + target["name"] + "/*.cpp",
            ],
        ),
        raw_headers = ["lib/Target/" + target["name"] + "/" + target["short_name"] + ".h"] + glob(
            [
                "lib/Target/" + target["name"] + "/GISel/*.h",
                "lib/Target/" + target["name"] + "/*.h",
                "lib/Target/" + target["name"] + "/*.def",
                "lib/Target/" + target["name"] + "/*.inc",
            ],
        ),
        public_include_directories = ["lib/Target/" + target["name"]],
        visibility = ["PUBLIC"],
        exported_deps = [
            ":Analysis",
            ":BinaryFormat",
            ":CFGuard",
            ":CodeGen",
            ":CodeGenTypes",
            ":Core",
            ":IPO",
            ":MC",
            ":Passes",  # TODO(chandlerc): Likely a layering violation.
            ":ProfileData",
            ":Scalar",
            ":Support",
            ":Target",
            ":TransformUtils",
            ":Vectorize",
            ":config",
            ":" + target["name"] + "Analysis",
            ":" + target["name"] + "CommonTableGen",
            ":" + target["name"] + "Info",
            ":" + target["name"] + "UtilsAndDesc",
        ] + target.get("tbl_deps", []),
    )],
    [llvm_library(
        name = target["name"] + "AsmParser",
        srcs = glob(
            [
                "lib/Target/" + target["name"] + "/AsmParser/*.cpp",
            ],
        ),
        raw_headers = glob(
            [
                "lib/Target/" + target["name"] + "/AsmParser/*.h",
            ],
        ),
        public_include_directories = ["include"],
        visibility = ["PUBLIC"],
        exported_deps = [
            ":BinaryFormat",
            ":CodeGenTypes",
            ":MC",
            ":MCParser",
            ":Support",
            ":Target",
            ":TargetParser",
            ":" + target["name"] + "CodeGen",
            ":" + target["name"] + "CommonTableGen",
            ":" + target["name"] + "Info",
            ":" + target["name"] + "UtilsAndDesc",
        ],
    )],
    # This target is a bit of a hack to allow us to expose internal
    # disassembler header files via internal target-relative include paths.
    # This usage of headers is inherently non-modular as there is a mixture of
    # target-relative inclusion using this rule and same-directory inclusion
    # using the repeated listing of these headers in the `srcs` below.
    [llvm_library(
        name = target["name"] + "DisassemblerInternalHeaders",
        # FIXME: This should be `textual_hdrs` instead of `hdrs`, but
        # unfortunately that doesn't work with `strip_include_prefix`:
        # https://github.com/bazelbuild/bazel/issues/12424
        #
        # Once that issue is fixed and released, we can switch this to
        # `textual_hdrs` and remove the feature disabling the various Bazel
        # features (both current and under-development) that motivated the
        # distinction between these two.
        raw_headers = glob(
            [
                "lib/Target/" + target["name"] + "/Disassembler/*.h",
            ],
        ),
        public_include_directories = ["lib/Target/" + target["name"]],
    )],
    [llvm_library(
        name = target["name"] + "Disassembler",
        srcs = glob(
            [
                "lib/Target/" + target["name"] + "/Disassembler/*.cpp",
                "lib/Target/" + target["name"] + "/Disassembler/*.c",
            ],
        ),
        raw_headers = glob(
            [
                "lib/Target/" + target["name"] + "/Disassembler/*.h",
            ],
        ),
        public_include_directories = ["include"],
        visibility = ["PUBLIC"],
        exported_deps = [
            ":CodeGenTypes",
            ":Core",
            ":MC",
            ":MCDisassembler",
            ":Support",
            ":Target",
            ":" + target["name"] + "CodeGen",
            ":" + target["name"] + "DisassemblerInternalHeaders",
            ":" + target["name"] + "CommonTableGen",
            ":" + target["name"] + "UtilsAndDesc",
        ],
    )],
    [llvm_library(
        name = target["name"] + "TargetMCA",
        srcs = glob(
            [
                "lib/Target/" + target["name"] + "/MCA/*.cpp",
                "lib/Target/" + target["name"] + "/MCA/*.c",
            ],
        ),
        raw_headers = glob(
            [
                "lib/Target/" + target["name"] + "/MCA/*.h",
            ],
        ),
        visibility = ["PUBLIC"],
        exported_deps = [
            ":CodeGenTypes",
            ":MC",
            ":MCA",
            ":MCParser",
            ":Support",
            ":" + target["name"] + "DisassemblerInternalHeaders",
            ":" + target["name"] + "Info",
            ":" + target["name"] + "UtilsAndDesc",
        ],
    )],
    [llvm_library(
        name = target["name"] + "Analysis",
        srcs = glob(
            [
                "lib/Target/" + target["name"] + "/Analysis/*.cpp",
                "lib/Target/" + target["name"] + "/Analysis/*.h",
            ],
        ),
        exported_deps = [
            ":Analysis",
            ":Core",
            ":Support",
            ":TransformUtils",
        ],
    )],
] for target in llvm_target_lib_list]

llvm_library(
    name = "AllTargetsCodeGens",
    visibility = ["PUBLIC"],
    exported_deps = [
        ":" + target["name"] + "CodeGen"
        for target in llvm_target_lib_list
    ],
)

llvm_library(
    name = "AllTargetsAsmParsers",
    visibility = ["PUBLIC"],
    exported_deps = [
        ":" + target["name"] + "AsmParser"
        for target in llvm_target_lib_list
    ],
)

llvm_library(
    name = "AllTargetsDisassemblers",
    visibility = ["PUBLIC"],
    exported_deps = [
        ":" + target["name"] + "Disassembler"
        for target in llvm_target_lib_list
    ],
)

llvm_library(
    name = "AllTargetsMCAs",
    visibility = ["PUBLIC"],
    exported_deps = [
        ":" + target["name"] + "TargetMCA"
        for target in llvm_target_lib_list
    ],
)

llvm_library(
    name = "pass_registry_def",
    header_namespace = "",
    raw_headers = ["lib/Passes/PassRegistry.def"],
)

llvm_library(
    name = "Passes",
    srcs = glob([
        "lib/Passes/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/Passes/*.h",
        "include/llvm/Passes/*.def",
        "include/llvm/Passes/*.inc",
    ]) + [
        "include/llvm-c/Transforms/PassBuilder.h",
    ],
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AggressiveInstCombine",
        ":Analysis",
        ":CFGuard",
        ":CodeGen",
        ":Core",
        ":Coroutines",
        ":HipStdPar",
        ":IPO",
        ":IRPrinter",
        ":InstCombine",
        ":Instrumentation",
        ":MC",
        ":ObjCARC",
        ":Scalar",
        ":Support",
        ":Target",
        ":TransformUtils",
        ":Vectorize",
        ":common_transforms",
        ":config",
        ":pass_registry_def",
    ],
)

llvm_library(
    name = "LTO",
    srcs = glob([
        "lib/LTO/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/LTO/*.h",
        "include/llvm/LTO/legacy/*.h",
    ]) + [
        "include/llvm-c/lto.h",
    ],
    compiler_flags = [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Analysis",
        ":BitReader",
        ":BitWriter",
        ":CGData",
        ":CodeGen",
        ":CodeGenTypes",
        ":Core",
        ":IPO",
        ":IRPrinter",
        ":IRReader",
        ":Linker",
        ":MC",
        ":MCParser",
        ":ObjCARC",
        ":Object",
        ":Passes",
        ":Remarks",
        ":Scalar",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":common_transforms",
        ":config",
    ],
)

llvm_library(
    name = "ExecutionEngine",
    srcs = glob([
        "lib/ExecutionEngine/*.cpp",
        "lib/ExecutionEngine/RuntimeDyld/*.cpp",
        "lib/ExecutionEngine/RuntimeDyld/Targets/*.cpp",
    ]),
    raw_headers = glob(
        [
            "include/llvm/ExecutionEngine/*.h",
            "lib/ExecutionEngine/RuntimeDyld/*.h",
            "lib/ExecutionEngine/RuntimeDyld/Targets/*.h",
        ],
        exclude = [
            "include/llvm/ExecutionEngine/MCJIT*.h",
            "include/llvm/ExecutionEngine/OProfileWrapper.h",
        ],
    ) + [
        "include/llvm-c/ExecutionEngine.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":CodeGen",
        ":Core",
        ":DebugInfo",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":OrcShared",
        ":OrcTargetProcess",
        ":Passes",
        ":Support",
        ":Target",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "Interpreter",
    srcs = glob([
        "lib/ExecutionEngine/Interpreter/*.cpp",
    ]),
    raw_headers = glob([
        "lib/ExecutionEngine/Interpreter/*.h"
    ]) + [
        "include/llvm/ExecutionEngine/Interpreter.h"
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":CodeGen",
        ":Core",
        ":ExecutionEngine",
        ":Support",
        ":Target",
        ":config",
    ],
)

gentbl_cc_library(
    name = "JITLinkTableGen",
    strip_include_prefix = "lib/ExecutionEngine/JITLink",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "lib/ExecutionEngine/JITLink/COFFOptions.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "lib/ExecutionEngine/JITLink/COFFOptions.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "JITLink",
    srcs = glob([
        "lib/ExecutionEngine/JITLink/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ExecutionEngine/JITLink/*.h",
        "include/llvm/ExecutionEngine/Orc/*.h",
        "lib/ExecutionEngine/JITLink/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":ExecutionEngine",
        ":JITLinkTableGen",
        ":Object",
        ":Option",
        ":OrcShared",
        ":OrcTargetProcess",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "MCJIT",
    srcs = glob([
        "lib/ExecutionEngine/MCJIT/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ExecutionEngine/MCJIT*.h",
        "lib/ExecutionEngine/MCJIT/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":CodeGen",
        ":Core",
        ":ExecutionEngine",
        ":MC",
        ":Object",
        ":Support",
        ":Target",
        ":config",
    ],
)

llvm_library(
    name = "OrcJIT",
    srcs = glob([
        "lib/ExecutionEngine/Orc/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ExecutionEngine/Orc/*.h",
    ]) + [
        "include/llvm-c/LLJIT.h",
        "include/llvm-c/Orc.h",
        "include/llvm-c/OrcEE.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_linker_flags = select({
        "prelude//os:android": [],
        "prelude//os:windows": [],
        "prelude//os:freebsd": [],
        "prelude//os:macos": [],
        "DEFAULT": [
            "-lrt",
        ],
    }),
    exported_deps = [
        ":Analysis",
        ":BinaryFormat",
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":DebugInfoDWARF",
        ":ExecutionEngine",
        ":JITLink",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":OrcShared",
        ":OrcTargetProcess",
        ":Passes",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":WindowsDriver",
        ":config",
    ],
)

llvm_library(
    name = "OrcShared",
    srcs = glob([
        "lib/ExecutionEngine/Orc/Shared/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ExecutionEngine/Orc/Shared/*.h",
    ]) + [
        "include/llvm/ExecutionEngine/Orc/SymbolStringPool.h",
    ],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":CodeGen",
        ":Core",
        ":DebugInfo",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":Passes",
        ":Support",
        ":Target",
        ":config",
    ],
)

llvm_library(
    name = "OrcDebugging",
    srcs = glob([
        "lib/ExecutionEngine/Orc/Debugging/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ExecutionEngine/Orc/Debugging/*.h",
    ]) + ["include/llvm-c/LLJITUtils.h"],
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":DebugInfo",
        ":DebugInfoDWARF",
        ":JITLink",
        ":OrcJIT",
        ":OrcShared",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "OrcTargetProcess",
    srcs = glob([
        "lib/ExecutionEngine/Orc/TargetProcess/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/ExecutionEngine/Orc/TargetProcess/*.h",
        "lib/ExecutionEngine/Orc/TargetProcess/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_linker_flags = select({
        "prelude//os:android": [],
        "prelude//os:windows": [],
        "prelude//os:freebsd": [],
        "prelude//os:macos": [],
        "DEFAULT": [
            "-lrt",
        ],
    }),
    exported_deps = [
        ":BinaryFormat",
        ":CodeGen",
        ":Core",
        ":DebugInfo",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":OrcShared",
        ":Passes",
        ":Support",
        ":Target",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "DWARFLinker",
    srcs = glob([
        "lib/DWARFLinker/Classic/*.cpp",
    ]),
    raw_headers = glob(["include/llvm/DWARFLinker/Classic/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":CodeGen",
        ":CodeGenTypes",
        ":DWARFLinkerBase",
        ":DebugInfoDWARF",
        ":MC",
        ":Support",
        ":Target",
        ":TargetParser",
    ],
)

llvm_library(
    name = "DWARFLinkerBase",
    srcs = glob([
        "lib/DWARFLinker/*.cpp",
    ]),
    raw_headers = glob(["include/llvm/DWARFLinker/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":CodeGen",
        ":DebugInfoDWARF",
        ":Support",
        ":Target",
    ],
)

llvm_library(
    name = "DWARFLinkerParallel",
    srcs = glob([
        "lib/DWARFLinker/Parallel/*.cpp",
    ]),
    raw_headers = glob([
        "lib/DWARFLinker/Parallel/*.h",
        "include/llvm/DWARFLinker/Parallel/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":CodeGen",
        ":DWARFLinkerBase",
        ":DebugInfoDWARF",
        ":MC",
        ":Object",
        ":Support",
        ":Target",
        ":TargetParser",
    ],
)

gentbl_cc_library(
    name = "DllOptionsTableGen",
    strip_include_prefix = "lib/ToolDrivers/llvm-dlltool",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "lib/ToolDrivers/llvm-dlltool/Options.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "lib/ToolDrivers/llvm-dlltool/Options.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "DlltoolDriver",
    srcs = glob(["lib/ToolDrivers/llvm-dlltool/*.cpp"]),
    raw_headers = glob(["include/llvm/ToolDrivers/llvm-dlltool/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":DllOptionsTableGen",
        ":Object",
        ":Option",
        ":Support",
        ":TargetParser",
    ],
)

gentbl_cc_library(
    name = "LibOptionsTableGen",
    strip_include_prefix = "lib/ToolDrivers/llvm-lib",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "lib/ToolDrivers/llvm-lib/Options.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "lib/ToolDrivers/llvm-lib/Options.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "LibDriver",
    srcs = glob(["lib/ToolDrivers/llvm-lib/*.cpp"]),
    raw_headers = glob(["include/llvm/ToolDrivers/llvm-lib/*.h"]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":BitReader",
        ":LibOptionsTableGen",
        ":Object",
        ":Option",
        ":Support",
    ],
)

llvm_library(
    name = "InterfaceStub",
    srcs = glob([
        "lib/InterfaceStub/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/InterfaceStub/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":MC",
        ":Object",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_library(
    name = "WindowsDriver",
    srcs = glob([
        "lib/WindowsDriver/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/WindowsDriver/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Option",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "WindowsManifest",
    srcs = glob([
        "lib/WindowsManifest/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/WindowsManifest/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Support",
        ":config",
    ],
)

llvm_library(
    name = "MCA",
    srcs = glob([
        "lib/MCA/**/*.cpp",
    ]),
    raw_headers = glob([
        "include/llvm/MCA/**/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":Support",
    ],
)

llvm_library(
    name = "MCAApplication",
    srcs = glob([
        "tools/llvm-mca/Views/*.cpp",
    ]) + [
        mca_source
        for mca_source in glob(["tools/llvm-mca/*.cpp"])
        if mca_source != "tools/llvm-mca/llvm-mca.cpp"
    ],
    raw_headers = glob([
        "tools/llvm-mca/*.h",
        "tools/llvm-mca/Views/*.h",
    ]),
    public_include_directories = ["tools/llvm-mca"],
    exported_deps = [
        ":MC",
        ":MCA",
        ":MCParser",
        ":Support",
        ":TargetParser",
    ],
)

llvm_library(
    name = "XRay",
    srcs = glob([
        "lib/XRay/*.cpp",
    ]),
    raw_headers = glob(["include/llvm/XRay/*.h"]),
    exported_deps = [
        ":Object",
        ":Support",
        ":TargetParser",
    ],
)

# command line flags through --config
# e.g. buck2 build llvm-project/llvm: --config pfm.flag=disable
config_setting(
    name = "pfm_disable",
    values = {"pfm.flag": "disable"},
    visibility = ["PUBLIC",],
)

config_setting(
    name = "pfm_external",
    values = {"pfm.flag": "external"},
    visibility = ["PUBLIC",],
)

config_setting(
    name = "pfm_system",
    values = {"pfm.flag": "system"},
    visibility = ["PUBLIC",],
)

llvm_library(
    name = "Exegesis",
    srcs = glob(
        [
            "tools/llvm-exegesis/lib/*.cpp",
        ] + [
            "tools/llvm-exegesis/lib/{}/*.cpp".format(t)
            for t in llvm_target_exegesis
        ],
    ),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
    raw_headers = glob(
        [
            "tools/llvm-exegesis/lib/*.h"
        ] + [
            "tools/llvm-exegesis/lib/{}/*.h".format(t)
            for t in llvm_target_exegesis
        ]
    ),
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":CodeGen",
        ":CodeGenTypes",
        ":Core",
        ":ExecutionEngine",
        ":MC",
        ":MCA",
        ":MCDisassembler",
        ":Object",
        ":ObjectYAML",
        ":OrcJIT",
        ":Support",
        ":Target",
        ":config",
    ] + select({
        "prelude//os:linux": select({
            ":pfm_external": ["//third-party/libpfm4:libpfm4"],
            ":pfm_system": ["//third-party/libpfm4:libpfm4"],
            ":pfm_disable": [],
            "DEFAULT": [],
        }),
        "DEFAULT": [],
    }),
    exported_preprocessor_flags = select({
        "prelude//os:linux": select({
            ":pfm_external": ["-DHAVE_LIBPFM=1"],
            ":pfm_system": ["-DHAVE_LIBPFM=1"],
            ":pfm_disable": [],
            "DEFAULT": [],
        }),
        "DEFAULT": [],
    }),
)

################################################################################
# LLVM toolchain and development binaries

gentbl_cc_library(
    name = "DsymutilTableGen",
    strip_include_prefix = "tools/dsymutil",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/dsymutil/Options.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/dsymutil/Options.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "dsymutil-lib",
    srcs = glob([
        "tools/dsymutil/*.cpp",
    ]),
    raw_headers = glob(["tools/dsymutil/*.h"]),
    exported_deps = [
        ":AllTargetsCodeGens",
        ":BinaryFormat",
        ":CodeGen",
        ":CodeGenTypes",
        ":DWARFLinker",
        ":DWARFLinkerParallel",
        ":DebugInfo",
        ":DebugInfoDWARF",
        ":DsymutilTableGen",
        ":MC",
        ":Object",
        ":Option",
        ":Remarks",
        ":Support",
        ":Target",
        ":TargetParser",
        ":config",
        ":remark_linker",
    ],
)

llvm_driver_cc_binary(
    name = "dsymutil",
    deps = [":dsymutil-lib"],
)

llvm_binary(
    name = "llc",
    srcs = glob([
        "tools/llc/*.cpp",
    ]),
    headers = glob(["tools/llc/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":Analysis",
        ":AsmParser",
        ":BitReader",
        ":CodeGen",
        ":CodeGenTypes",
        ":Core",
        ":IRPrinter",
        ":IRReader",
        ":MC",
        ":Passes",
        ":Remarks",
        ":Scalar",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
    ],
)

llvm_binary(
    name = "lli",
    srcs = glob([
        "tools/lli/*.cpp",
    ]),
    headers = glob(["tools/lli/*.h"]),
    visibility = ["PUBLIC"],
    # ll scripts rely on symbols from dependent
    # libraries being resolvable.
    linker_flags = select({
        "prelude//os:windows": [],
        "prelude//os:macos": [],
        "DEFAULT": [
            "-Wl,--undefined=_ZTIi",
            "-Wl,--export-dynamic-symbol=_ZTIi",
            "-Wl,--export-dynamic-symbol=__cxa_begin_catch",
            "-Wl,--export-dynamic-symbol=__cxa_end_catch",
            "-Wl,--export-dynamic-symbol=__gxx_personality_v0",
            "-Wl,--export-dynamic-symbol=__cxa_allocate_exception",
            "-Wl,--export-dynamic-symbol=__cxa_throw",
            "-Wl,--export-dynamic-symbol=llvm_orc_registerJITLoaderGDBWrapper",
            "-Wl,--export-dynamic-symbol=llvm_orc_registerEHFrameSectionWrapper",
            "-Wl,--export-dynamic-symbol=llvm_orc_deregisterEHFrameSectionWrapper",
        ],
    }),
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AsmParser",
        ":BitReader",
        ":CodeGen",
        ":Core",
        ":ExecutionEngine",
        ":IRPrinter",
        ":IRReader",
        ":Instrumentation",
        ":Interpreter",
        ":MCJIT",
        ":Object",
        ":OrcDebugging",
        ":OrcJIT",
        ":OrcTargetProcess",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

################################################################################
# LLVM toolchain and development binaries

llvm_library(
    name = "llvm-ar-lib",
    srcs = glob(["tools/llvm-ar/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":BinaryFormat",
        ":Core",
        ":DlltoolDriver",
        ":LibDriver",
        ":Object",
        ":Support",
        ":TargetParser",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-ar",
    aliases = [
        "llvm-dlltool",
        "llvm-lib",
        "llvm-ranlib",
    ],
    deps = [":llvm-ar-lib"],
)

llvm_binary(
    name = "llvm-as",
    srcs = glob([
        "tools/llvm-as/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Analysis",
        ":AsmParser",
        ":BitWriter",
        ":Core",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-bcanalyzer",
    srcs = glob([
        "tools/llvm-bcanalyzer/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":BitReader",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-cat",
    srcs = glob([
        "tools/llvm-cat/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":IRPrinter",
        ":IRReader",
        ":Support",
    ],
)

gentbl_cc_library(
    name = "CGDataOptsTableGen",
    strip_include_prefix = "tools/llvm-cgdata",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-cgdata/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-cgdata/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-cgdata-lib",
    srcs = glob(["tools/llvm-cgdata/*.cpp"]),
    exported_deps = [
        ":CGData",
        ":CGDataOptsTableGen",
        ":CodeGen",
        ":Core",
        ":Object",
        ":Option",
        ":Support",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-cgdata",
    deps = [":llvm-cgdata-lib"],
)

llvm_binary(
    name = "llvm-cfi-verify",
    srcs = glob([
        "tools/llvm-cfi-verify/*.cpp",
        "tools/llvm-cfi-verify/lib/*.cpp",
    ]),
    headers = glob(["tools/llvm-cfi-verify/lib/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":BinaryFormat",
        ":DebugInfoDWARF",
        ":MC",
        ":MCDisassembler",
        ":MCParser",
        ":Object",
        ":Support",
        ":Symbolize",
    ],
)

llvm_binary(
    name = "llvm-cov",
    srcs = glob([
        "tools/llvm-cov/*.cpp",
    ]),
    headers = glob(["tools/llvm-cov/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":Coverage",
        ":Debuginfod",
        ":Instrumentation",
        ":Object",
        ":ProfileData",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

gentbl_cc_library(
    name = "CvtResTableGen",
    strip_include_prefix = "tools/llvm-cvtres",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-cvtres/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-cvtres/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_binary(
    name = "llvm-cvtres",
    srcs = glob([
        "tools/llvm-cvtres/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":BinaryFormat",
        ":CvtResTableGen",
        ":Object",
        ":Option",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-cxxdump",
    srcs = glob([
        "tools/llvm-cxxdump/*.cpp",
    ]),
    headers = glob(["tools/llvm-cxxdump/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsCodeGens",
        ":BitReader",
        ":MC",
        ":Object",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-cxxmap",
    srcs = glob([
        "tools/llvm-cxxmap/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":ProfileData",
        ":Support",
    ],
)

gentbl_cc_library(
    name = "CxxfiltOptsTableGen",
    strip_include_prefix = "tools/llvm-cxxfilt",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-cxxfilt/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-cxxfilt/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-cxxfilt-lib",
    srcs = glob(["tools/llvm-cxxfilt/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":CxxfiltOptsTableGen",
        ":Demangle",
        ":Option",
        ":Support",
        ":TargetParser",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-cxxfilt",
    deps = [":llvm-cxxfilt-lib"],
)

llvm_binary(
    name = "llvm-debuginfo-analyzer",
    srcs = glob([
        "tools/llvm-debuginfo-analyzer/*.cpp",
    ]),
    headers = glob(["tools/llvm-debuginfo-analyzer/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":DebugInfoLogicalView",
        ":Support",
    ],
)

gentbl_cc_library(
    name = "DebugInfodFindOptsTableGen",
    strip_include_prefix = "tools/llvm-debuginfod-find",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-debuginfod-find/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-debuginfod-find/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-debuginfod-find-lib",
    srcs = glob([
        "tools/llvm-debuginfod-find/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BitReader",
        ":Core",
        ":DebugInfodFindOptsTableGen",
        ":Debuginfod",
        ":Option",
        ":Support",
        ":Symbolize",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-debuginfod-find",
    deps = [":llvm-debuginfod-find-lib"],
)

llvm_binary(
    name = "llvm-dis",
    srcs = glob([
        "tools/llvm-dis/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Analysis",
        ":BitReader",
        ":Core",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-dwarfdump",
    srcs = glob([
        "tools/llvm-dwarfdump/*.cpp",
    ]),
    headers = glob(["tools/llvm-dwarfdump/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsCodeGens",
        ":BinaryFormat",
        ":DebugInfo",
        ":DebugInfoDWARF",
        ":MC",
        ":Object",
        ":Support",
        ":TargetParser",
    ],
)

gentbl_cc_library(
    name = "DwarfutilOptionsTableGen",
    strip_include_prefix = "tools/llvm-dwarfutil",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-dwarfutil/Options.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-dwarfutil/Options.td",
    deps = [":OptParserTdFiles"],
)

llvm_binary(
    name = "llvm-dwarfutil",
    srcs = glob([
        "tools/llvm-dwarfutil/*.cpp",
    ]),
    headers = glob(["tools/llvm-dwarfutil/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":CodeGenTypes",
        ":DWARFLinker",
        ":DWARFLinkerParallel",
        ":DebugInfoDWARF",
        ":DwarfutilOptionsTableGen",
        ":MC",
        ":ObjCopy",
        ":Object",
        ":Option",
        ":Support",
        ":Target",
        ":TargetParser",
    ],
)

gentbl_cc_library(
    name = "DwpOptionsTableGen",
    strip_include_prefix = "tools/llvm-dwp",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-dwp/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-dwp/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-dwp-lib",
    srcs = glob(["tools/llvm-dwp/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsCodeGens",
        ":DWP",
        ":DwpOptionsTableGen",
        ":MC",
        ":Option",
        ":Support",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-dwp",
    deps = [":llvm-dwp-lib"],
)

llvm_binary(
    name = "llvm-exegesis",
    srcs = [
        "tools/llvm-exegesis/llvm-exegesis.cpp",
    ],
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":CodeGenTypes",
        ":Exegesis",
        ":MC",
        ":MCParser",
        ":Object",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

llvm_binary(
    name = "llvm-extract",
    srcs = glob([
        "tools/llvm-extract/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AsmParser",
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":IPO",
        ":IRPrinter",
        ":IRReader",
        ":Passes",
        ":Support",
    ],
)

gentbl_cc_library(
    name = "GSYMUtilOptionsTableGen",
    strip_include_prefix = "tools/llvm-gsymutil",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-gsymutil/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-gsymutil/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-gsymutil-lib",
    srcs = glob(["tools/llvm-gsymutil/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsCodeGens",
        ":DebugInfo",
        ":DebugInfoDWARF",
        ":DebugInfoGSYM",
        ":GSYMUtilOptionsTableGen",
        ":MC",
        ":Object",
        ":Option",
        ":Support",
        ":Target",
        ":TargetParser",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-gsymutil",
    deps = [":llvm-gsymutil-lib"],
)

gentbl_cc_library(
    name = "IfsOptionsTableGen",
    strip_include_prefix = "tools/llvm-ifs",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-ifs/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-ifs/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-ifs-lib",
    srcs = glob([
        "tools/llvm-ifs/*.cpp",
    ]),
    raw_headers = glob(["tools/llvm-ifs/*.h"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":IfsOptionsTableGen",
        ":InterfaceStub",
        ":ObjectYAML",
        ":Option",
        ":Support",
        ":TargetParser",
        ":TextAPI",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-ifs",
    deps = [":llvm-ifs-lib"],
)

llvm_binary(
    name = "llvm-jitlink",
    srcs = glob([
        "tools/llvm-jitlink/*.cpp",
    ]),
    headers = glob(["tools/llvm-jitlink/*.h"]),
    visibility = ["PUBLIC"],
    # Make symbols from the standard library dynamically resolvable.
    linker_flags = select({
        "prelude//os:windows": [],
        "prelude//os:macos": [],
        "DEFAULT": [
            "-Wl,--undefined=_ZTIi",
            "-Wl,--export-dynamic-symbol=_ZTIi",
            "-Wl,--export-dynamic-symbol=__cxa_begin_catch",
            "-Wl,--export-dynamic-symbol=__cxa_end_catch",
            "-Wl,--export-dynamic-symbol=__gxx_personality_v0",
            "-Wl,--export-dynamic-symbol=__cxa_allocate_exception",
            "-Wl,--export-dynamic-symbol=__cxa_throw",
            "-Wl,--export-dynamic-symbol=llvm_orc_registerJITLoaderGDBWrapper",
        ],
    }),
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":AsmParser",
        ":BinaryFormat",
        ":BitReader",
        ":CodeGen",
        ":ExecutionEngine",
        ":MC",
        ":MCDisassembler",
        ":MCJIT",
        ":Object",
        ":OrcDebugging",
        ":OrcJIT",
        ":OrcShared",
        ":OrcTargetProcess",
        ":Support",
        ":TargetParser",
        ":config",
    ],
)

gentbl_cc_library(
    name = "LibtoolDarwinOptionsTableGen",
    strip_include_prefix = "tools/llvm-libtool-darwin",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-libtool-darwin/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-libtool-darwin/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-libtool-darwin-lib",
    srcs = glob([
        "tools/llvm-libtool-darwin/*.cpp",
    ]),
    raw_headers = glob(["tools/llvm-libtool-darwin/*.h"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":BinaryFormat",
        ":Core",
        ":LibtoolDarwinOptionsTableGen",
        ":Object",
        ":Option",
        ":Support",
        ":TextAPI",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-libtool-darwin",
    deps = [":llvm-libtool-darwin-lib"],
)

llvm_binary(
    name = "llvm-link",
    srcs = glob([
        "tools/llvm-link/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AsmParser",
        ":BinaryFormat",
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":IPO",
        ":IRPrinter",
        ":IRReader",
        ":Linker",
        ":Object",
        ":Support",
        ":TransformUtils",
    ],
)

gentbl_cc_library(
    name = "LipoOptsTableGen",
    strip_include_prefix = "tools/llvm-lipo",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-lipo/LipoOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-lipo/LipoOpts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-lipo-lib",
    srcs = ["tools/llvm-lipo/llvm-lipo.cpp"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":BinaryFormat",
        ":Core",
        ":LipoOptsTableGen",
        ":Object",
        ":Option",
        ":Support",
        ":TargetParser",
        ":TextAPI",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-lipo",
    deps = [":llvm-lipo-lib"],
)

llvm_binary(
    name = "llvm-lto",
    srcs = glob([
        "tools/llvm-lto/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":BitReader",
        ":BitWriter",
        ":CodeGen",
        ":Core",
        ":IRPrinter",
        ":IRReader",
        ":LTO",
        ":Support",
        ":Target",
    ],
)

llvm_binary(
    name = "llvm-lto2",
    srcs = glob([
        "tools/llvm-lto2/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":BitReader",
        ":CodeGen",
        ":Core",
        ":LTO",
        ":Passes",
        ":Remarks",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-mc",
    srcs = glob([
        "tools/llvm-mc/*.cpp",
    ]),
    headers = glob(["tools/llvm-mc/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":MC",
        ":MCDisassembler",
        ":MCParser",
        ":Object",
        ":Support",
        ":TargetParser",
    ],
)

llvm_binary(
    name = "llvm-mca",
    srcs = [
        "tools/llvm-mca/llvm-mca.cpp",
    ],
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":AllTargetsMCAs",
        ":MC",
        ":MCA",
        ":MCAApplication",
        ":MCParser",
        ":Support",
        ":TargetParser",
    ],
)

gentbl_cc_library(
    name = "MlTableGen",
    strip_include_prefix = "tools/llvm-ml",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-ml/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-ml/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-ml-lib",
    srcs = glob([
        "tools/llvm-ml/*.cpp",
    ]),
    raw_headers = glob(["tools/llvm-ml/*.h"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":MC",
        ":MCDisassembler",
        ":MCParser",
        ":MlTableGen",
        ":Option",
        ":Support",
        ":TargetParser",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-ml",
    deps = [":llvm-ml-lib"],
)

llvm_binary(
    name = "llvm-modextract",
    srcs = glob([
        "tools/llvm-modextract/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":BitReader",
        ":BitWriter",
        ":IRPrinter",
        ":IRReader",
        ":Support",
    ],
)

gentbl_cc_library(
    name = "MtTableGen",
    strip_include_prefix = "tools/llvm-mt",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-mt/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-mt/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-mt-lib",
    srcs = glob(["tools/llvm-mt/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":MtTableGen",
        ":Option",
        ":Support",
        ":WindowsManifest",
        ":config",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-mt",
    deps = [":llvm-mt-lib"],
)

gentbl_cc_library(
    name = "NmOptsTableGen",
    strip_include_prefix = "tools/llvm-nm",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-nm/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-nm/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-nm-lib",
    srcs = glob(["tools/llvm-nm/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":BinaryFormat",
        ":BitReader",
        ":Core",
        ":Demangle",
        ":NmOptsTableGen",
        ":Object",
        ":Option",
        ":Support",
        ":Symbolize",
        ":TargetParser",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-nm",
    deps = [":llvm-nm-lib"],
)

td_library(
    name = "LlvmObjcopyCommonOpts",
    srcs = ["tools/llvm-objcopy/CommonOpts.td"],
)

gentbl_cc_library(
    name = "llvm-objcopy-opts",
    strip_include_prefix = "tools/llvm-objcopy",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-objcopy/ObjcopyOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-objcopy/ObjcopyOpts.td",
    deps = [
        ":LlvmObjcopyCommonOpts",
        ":OptParserTdFiles",
    ],
)

gentbl_cc_library(
    name = "llvm-installnametool-opts",
    strip_include_prefix = "tools/llvm-objcopy",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-objcopy/InstallNameToolOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-objcopy/InstallNameToolOpts.td",
    deps = [
        ":LlvmObjcopyCommonOpts",
        ":OptParserTdFiles",
    ],
)

gentbl_cc_library(
    name = "llvm-strip-opts",
    strip_include_prefix = "tools/llvm-objcopy",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-objcopy/StripOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-objcopy/StripOpts.td",
    deps = [
        ":LlvmObjcopyCommonOpts",
        ":OptParserTdFiles",
    ],
)

gentbl_cc_library(
    name = "llvm-bitcode-strip-opts",
    strip_include_prefix = "tools/llvm-objcopy",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-objcopy/BitcodeStripOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-objcopy/BitcodeStripOpts.td",
    deps = [
        ":LlvmObjcopyCommonOpts",
        ":OptParserTdFiles",
    ],
)

llvm_binary(
    name = "llvm-stress",
    srcs = glob([
        "tools/llvm-stress/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Core",
        ":Support",
    ],
)

llvm_library(
    name = "llvm-objcopy-lib",
    srcs = glob([
        "tools/llvm-objcopy/*.cpp",
    ]),
    raw_headers = glob(["tools/llvm-objcopy/*.h"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":BinaryFormat",
        ":MC",
        ":ObjCopy",
        ":Object",
        ":ObjectYAML",
        ":Option",
        ":Support",
        ":Target",
        ":TargetParser",
        ":llvm-bitcode-strip-opts",
        ":llvm-installnametool-opts",
        ":llvm-objcopy-opts",
        ":llvm-strip-opts",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-objcopy",
    aliases = [
        "llvm-strip",
        "llvm-bitcode-strip",
        "llvm-install-name-tool",
    ],
    deps = [":llvm-objcopy-lib"],
)

llvm_library(
    name = "llvm-objdump-lib",
    srcs = glob([
        "tools/llvm-objdump/*.cpp",
    ]),
    raw_headers = glob(["tools/llvm-objdump/*.h"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":BinaryFormat",
        ":CodeGen",
        ":DebugInfo",
        ":DebugInfoBTF",
        ":DebugInfoDWARF",
        ":Debuginfod",
        ":Demangle",
        ":MC",
        ":MCDisassembler",
        ":ObjdumpOptsTableGen",
        ":Object",
        ":Option",
        ":OtoolOptsTableGen",
        ":Support",
        ":Symbolize",
        ":TargetParser",
        ":config",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-objdump",
    aliases = ["llvm-otool"],
    deps = [":llvm-objdump-lib"],
)

gentbl_cc_library(
    name = "ObjdumpOptsTableGen",
    strip_include_prefix = "tools/llvm-objdump",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-objdump/ObjdumpOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-objdump/ObjdumpOpts.td",
    deps = [":OptParserTdFiles"],
)

gentbl_cc_library(
    name = "OtoolOptsTableGen",
    strip_include_prefix = "tools/llvm-objdump",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-objdump/OtoolOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-objdump/OtoolOpts.td",
    deps = [":OptParserTdFiles"],
)

llvm_binary(
    name = "llvm-opt-report",
    srcs = glob([
        "tools/llvm-opt-report/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsCodeGens",
        ":Demangle",
        ":Remarks",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-pdbutil",
    srcs = glob([
        "tools/llvm-pdbutil/*.cpp",
    ]),
    headers = glob(["tools/llvm-pdbutil/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":BinaryFormat",
        ":DebugInfoBTF",
        ":DebugInfoCodeView",
        ":DebugInfoMSF",
        ":DebugInfoPDB",
        ":Object",
        ":ObjectYAML",
        ":Support",
        ":config",
    ],
)

llvm_library(
    name = "llvm-profdata-lib",
    srcs = glob(["tools/llvm-profdata/*.cpp"]),
    raw_headers = glob(["tools/llvm-profdata/*.h"]),
    public_include_directories = ["tools/llvm-profdata"],
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Core",
        ":Debuginfod",
        ":Object",
        ":ProfileData",
        ":Support",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-profdata",
    deps = [":llvm-profdata-lib"],
)

llvm_binary(
    name = "llvm-profgen",
    srcs = glob([
        "tools/llvm-profgen/*.cpp",
    ]),
    headers = glob(["tools/llvm-profgen/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":Core",
        ":DebugInfoDWARF",
        ":Demangle",
        ":IPO",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":ProfileData",
        ":Support",
        ":Symbolize",
        ":TargetParser",
    ],
)

gentbl_cc_library(
    name = "RcTableGen",
    strip_include_prefix = "tools/llvm-rc",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-rc/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-rc/Opts.td",
    deps = [":OptParserTdFiles"],
)

gentbl_cc_library(
    name = "WindresTableGen",
    strip_include_prefix = "tools/llvm-rc",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-rc/WindresOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-rc/WindresOpts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-rc-lib",
    srcs = glob([
        "tools/llvm-rc/*.cpp",
    ]),
    raw_headers = glob([
        "tools/llvm-rc/*.def",
        "tools/llvm-rc/*.h",
    ]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Object",
        ":Option",
        ":RcTableGen",
        ":Support",
        ":TargetParser",
        ":WindresTableGen",
        ":config",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-rc",
    aliases = ["llvm-windres"],
    deps = [":llvm-rc-lib"],
)

gentbl_cc_library(
    name = "ReadobjOptsTableGen",
    strip_include_prefix = "tools/llvm-readobj",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-readobj/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-readobj/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-readobj-lib",
    srcs = glob([
        "tools/llvm-readobj/*.cpp",
    ]),
    raw_headers = glob(["tools/llvm-readobj/*.h"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsCodeGens",
        ":BinaryFormat",
        ":BitReader",
        ":DebugInfoCodeView",
        ":DebugInfoDWARF",
        ":Demangle",
        ":MC",
        ":Object",
        ":Option",
        ":ReadobjOptsTableGen",
        ":Support",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-readobj",
    aliases = ["llvm-readelf"],
    deps = [":llvm-readobj-lib"],
)

llvm_binary(
    name = "llvm-reduce",
    srcs = glob([
        "tools/llvm-reduce/**/*.cpp",
    ]),
    headers = glob(["tools/llvm-reduce/**/*.h"]),
    visibility = ["PUBLIC"],
    include_directories = ["tools/llvm-reduce"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":Analysis",
        ":BitReader",
        ":BitWriter",
        ":CodeGen",
        ":CodeGenTypes",
        ":Core",
        ":IPO",
        ":IRReader",
        ":MC",
        ":Passes",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":config",
    ],
)

llvm_binary(
    name = "llvm-rtdyld",
    srcs = glob([
        "tools/llvm-rtdyld/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":DebugInfo",
        ":DebugInfoDWARF",
        ":ExecutionEngine",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":Support",
    ],
)

gentbl_cc_library(
    name = "SizeOptsTableGen",
    strip_include_prefix = "tools/llvm-size",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-size/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-size/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-size-lib",
    srcs = glob(["tools/llvm-size/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":Object",
        ":Option",
        ":SizeOptsTableGen",
        ":Support",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-size",
    deps = [":llvm-size-lib"],
)

llvm_binary(
    name = "llvm-split",
    srcs = glob([
        "tools/llvm-split/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":BitWriter",
        ":Core",
        ":IRPrinter",
        ":IRReader",
        ":MC",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
    ],
)

gentbl_cc_library(
    name = "StringsOptsTableGen",
    strip_include_prefix = "tools/llvm-strings",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-strings/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-strings/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_binary(
    name = "llvm-strings",
    srcs = glob([
        "tools/llvm-strings/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Object",
        ":Option",
        ":StringsOptsTableGen",
        ":Support",
    ],
)

gentbl_cc_library(
    name = "SymbolizerOptsTableGen",
    strip_include_prefix = "tools/llvm-symbolizer",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-symbolizer/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-symbolizer/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "llvm-symbolizer-lib",
    srcs = glob(["tools/llvm-symbolizer/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":DebugInfoDWARF",
        ":DebugInfoPDB",
        ":Debuginfod",
        ":Object",
        ":Option",
        ":Support",
        ":Symbolize",
        ":SymbolizerOptsTableGen",
        ":config",
    ],
)

llvm_driver_cc_binary(
    name = "llvm-symbolizer",
    aliases = ["llvm-addr2line"],
    deps = [":llvm-symbolizer-lib"],
)

llvm_binary(
    name = "llvm-undname",
    srcs = glob([
        "tools/llvm-undname/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Demangle",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-xray",
    srcs = glob([
        "tools/llvm-xray/*.cpp",
    ]),
    headers = glob(["tools/llvm-xray/*.h"]),
    visibility = ["PUBLIC"],
    deps = [
        ":DebugInfoDWARF",
        ":Object",
        ":Support",
        ":Symbolize",
        ":XRay",
    ],
)

llvm_library(
    name = "opt-driver",
    srcs = glob([
        "tools/opt/*.cpp",
    ]),
    raw_headers = glob(["tools/opt/*.h"]),
    visibility = ["PUBLIC"],
    linker_flags = select({
        "prelude//os:windows": [],
        "prelude//os:macos": [],
        "DEFAULT": ["-Wl,--export-dynamic"],
    }),
    exported_deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":Analysis",
        ":AsmParser",
        ":BitReader",
        ":BitWriter",
        ":CodeGen",
        ":Core",
        ":DebugInfoDWARF",
        ":IPO",
        ":IRPrinter",
        ":IRReader",
        ":Instrumentation",
        ":FrontendHLSL",
        ":MC",
        ":Passes",
        ":Remarks",
        ":Scalar",
        ":Support",
        ":Target",
        ":TargetParser",
        ":TransformUtils",
        ":common_transforms",
        ":config",
    ],
)

llvm_binary(
    name = "opt",
    deps = [":opt-driver"],
    visibility = ["PUBLIC"],
)

gentbl_cc_library(
    name = "SancovOptsTableGen",
    strip_include_prefix = "tools/sancov",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/sancov/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/sancov/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_library(
    name = "sancov-lib",
    srcs = glob(["tools/sancov/*.cpp"]),
    visibility = ["PUBLIC"],
    exported_deps = [
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":DebugInfoDWARF",
        ":DebugInfoPDB",
        ":MC",
        ":MCDisassembler",
        ":Object",
        ":Option",
        ":SancovOptsTableGen",
        ":Support",
        ":Symbolize",
    ],
)

llvm_driver_cc_binary(
    name = "sancov",
    deps = [":sancov-lib"],
)

llvm_binary(
    name = "sanstats",
    srcs = glob([
        "tools/sanstats/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Support",
        ":Symbolize",
        ":TransformUtils",
    ],
)

llvm_binary(
    name = "split-file",
    srcs = glob([
        "utils/split-file/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Support",
    ],
)

################################################################################
# Begin testonly libraries

llvm_library(
    name = "FuzzMutate",
    srcs = glob(["lib/FuzzMutate/*.cpp"]),
    raw_headers = glob(["include/llvm/FuzzMutate/*.h"]),
    visibility = ["PUBLIC"],
    public_include_directories = ["include"],
    exported_deps = [
        ":Analysis",
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":Scalar",
        ":Support",
        ":TargetParser",
        ":TransformUtils",
    ],
)

llvm_library(
    name = "Diff",
    srcs = glob(["tools/llvm-diff/lib/*.cpp"]),
    visibility = ["PUBLIC"],
    raw_headers = glob(["tools/llvm-diff/lib/*.h"]),
    exported_deps = [
        ":Core",
        ":Support",
    ],
)

native.python_bootstrap_library(
    name = "lit-lib",
    srcs = glob(["utils/lit/lit/**/*.py"]),
)

native.python_bootstrap_binary(
    name = "lit",
    main = "utils/lit/lit.py",
    copy_deps = False,
    visibility = ["PUBLIC"],
    deps = [":lit-lib"],
)

llvm_library(
    name =  "TestingADT",
    compiler_flags =  [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    visibility =  ["PUBLIC"],
    header_namespace =  "",
    raw_headers =  glob(["include/llvm/Testing/ADT/*.h"]),
    exported_deps =  [
        ":Support",
        "//third-party/googletest:gmock",
    ],
)

llvm_library(
    name =  "TestingSupport",
    srcs =  glob(["lib/Testing/Support/*.cpp"]),
    compiler_flags =  [
        "-Wno-error=header-hygiene",
        "-Wno-error=unused-but-set-variable",
    ],
    visibility =  ["PUBLIC"],
    header_namespace =  "",
    raw_headers =  glob(["include/llvm/Testing/Support/*.h"]),
    exported_deps =  [
        ":Support",
        ":config",
        "//third-party/googletest:gmock",
        "//third-party/googletest:gtest",
    ],
)

llvm_library(
    name = "TestingAnnotations",
    srcs = ["lib/Testing/Annotations/Annotations.cpp"],
    raw_headers = ["include/llvm/Testing/Annotations/Annotations.h"],
    visibility = ["PUBLIC"],
    exported_deps = [":Support"],
)

################################################################################
# Begin testonly binary utilities

llvm_binary(
    name = "FileCheck",
    srcs = glob([
        "utils/FileCheck/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":FileCheckLib",
        ":Support",
    ],
)

llvm_binary(
    name = "bugpoint",
    srcs = glob([
        "tools/bugpoint/*.cpp",
    ]),
    headers = glob([
        "tools/bugpoint/*.h",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":Analysis",
        ":AsmParser",
        ":BitReader",
        ":BitWriter",
        ":CodeGen",
        ":Core",
        ":IPO",
        ":IRPrinter",
        ":IRReader",
        ":Linker",
        ":Passes",
        ":Scalar",
        ":Support",
        ":TargetParser",
        ":TransformUtils",
        ":common_transforms",
        ":config",
    ],
)

llvm_binary(
    name = "count",
    srcs = glob([
        "utils/count/*.c",
    ]),
    visibility = ["PUBLIC"],
    deps = [":Support"],
)

llvm_binary(
    name = "lli-child-target",
    srcs = glob([
        "tools/lli/ChildTarget/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    # The tests load code into this binary that expect to see symbols
    # from libstdc++ such as __cxa_begin_catch and _ZTIi. The latter
    # isn't even used in the main binary, so we also need to force it
    # to be included.
    linker_flags = select({
        "prelude//os:windows": [],
        "prelude//os:macos": [],
        "DEFAULT": [
            "-rdynamic",
            "-u_ZTIi",
        ],
    }),
    deps = [
        ":OrcJIT",
        ":OrcTargetProcess",
        ":Support",
        ":attributes_gen",
        ":config",
        ":intrinsic_enums_gen",
    ],
)

llvm_binary(
    name = "llvm-c-test",
    srcs = glob([
        "tools/llvm-c-test/*.c",
        "tools/llvm-c-test/*.cpp",
    ]),
    headers = glob([
        "tools/llvm-c-test/*.h",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":AllTargetsDisassemblers",
        ":Analysis",
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":ExecutionEngine",
        ":IPO",
        ":IRReader",
        ":InstCombine",
        ":LTO",
        ":Linker",
        ":MCDisassembler",
        ":Object",
        ":OrcJIT",
        ":Passes",
        ":Remarks",
        ":Scalar",
        ":Support",
        ":Target",
        ":TransformUtils",
        ":Vectorize",
    ],
)

llvm_binary(
    name = "llvm-diff",
    srcs = glob([
        "tools/llvm-diff/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Core",
        ":Diff",
        ":IRPrinter",
        ":IRReader",
        ":Support",
    ],
)

llvm_binary(
    name = "llvm-isel-fuzzer",
    srcs = glob([
        "tools/llvm-isel-fuzzer/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsAsmParsers",
        ":AllTargetsCodeGens",
        ":Analysis",
        ":BitReader",
        ":BitWriter",
        ":CodeGen",
        ":Core",
        ":FuzzMutate",
        ":IRPrinter",
        ":IRReader",
        ":MC",
        ":Support",
        ":Target",
    ],
)

native.python_binary(
    name = "llvm-locstats",
    main = "utils/llvm-locstats/llvm-locstats.py",
    # llvm-locstats is a thin wrapper around llvm-dwarfdump.
    deps = [":llvm-dwarfdump"],
)

native.python_binary(
    name = "llvm-original-di-preservation",
    main = "utils/llvm-original-di-preservation.py",
)

llvm_binary(
    name = "not",
    srcs = glob([
        "utils/not/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [":Support"],
)

llvm_binary(
    name = "llvm-opt-fuzzer",
    srcs = glob([
        "tools/llvm-opt-fuzzer/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AllTargetsCodeGens",
        ":Analysis",
        ":BitReader",
        ":BitWriter",
        ":CodeGen",
        ":Core",
        ":Coroutines",
        ":FuzzMutate",
        ":MC",
        ":Passes",
        ":Support",
        ":Target",
    ],
)

gentbl_cc_library(
    name = "ReadTAPIOptsTableGen",
    strip_include_prefix = "tools/llvm-readtapi",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-readtapi/TapiOpts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-readtapi/TapiOpts.td",
    deps = [":OptParserTdFiles"],
)

llvm_binary(
    name = "llvm-readtapi",
    srcs = glob([
        "tools/llvm-readtapi/*.cpp",
    ]),
    headers = glob([
        "tools/llvm-readtapi/*.h",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":BinaryFormat",
        ":Object",
        ":Option",
        ":ReadTAPIOptsTableGen",
        ":Support",
        ":TextAPI",
        ":TextAPIBinaryReader",
    ],
)

gentbl_cc_library(
    name = "TLICheckerOptsTableGen",
    strip_include_prefix = "tools/llvm-tli-checker",
    tbl_outs = [(
        ["-gen-opt-parser-defs"],
        "tools/llvm-tli-checker/Opts.inc",
    )],
    tblgen = ":llvm-tblgen",
    td_file = "tools/llvm-tli-checker/Opts.td",
    deps = [":OptParserTdFiles"],
)

llvm_binary(
    name = "llvm-tli-checker",
    srcs = glob([
        "tools/llvm-tli-checker/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Analysis",
        ":BinaryFormat",
        ":BitReader",
        ":BitstreamReader",
        ":Core",
        ":Demangle",
        ":MC",
        ":MCParser",
        ":Object",
        ":Option",
        ":Remarks",
        ":Support",
        ":TLICheckerOptsTableGen",
        ":TargetParser",
        ":TextAPI",
        ":config",
    ],
)

llvm_binary(
    name = "obj2yaml",
    srcs = glob([
        "tools/obj2yaml/*.cpp",
    ]),
    headers = glob([
        "tools/obj2yaml/*.h",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":BinaryFormat",
        ":DebugInfoCodeView",
        ":DebugInfoDWARF",
        ":Object",
        ":ObjectYAML",
        ":Support",
    ],
)

llvm_binary(
    name = "verify-uselistorder",
    srcs = glob([
        "tools/verify-uselistorder/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":AsmParser",
        ":BitReader",
        ":BitWriter",
        ":Core",
        ":IRPrinter",
        ":IRReader",
        ":Support",
    ],
)

llvm_binary(
    name = "yaml2obj",
    srcs = glob([
        "tools/yaml2obj/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":BinaryFormat",
        ":DebugInfoCodeView",
        ":MC",
        ":Object",
        ":ObjectYAML",
        ":Support",
    ],
)

llvm_binary(
    name = "yaml-bench",
    srcs = glob([
        "utils/yaml-bench/*.cpp",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":Support",
    ],
)

################################################################################
# Gator Specific

llvm_library(
    name = "MIP",
    raw_headers = glob([
        "include/llvm/MIP/*.h",
        "include/llvm/MIP/*.inc",
        # Export these headers specifically in MIP to prevent cycles.
        "include/llvm/DebugInfo/DIContext.h",
        "include/llvm/Object/*.h",
    ]),
    public_include_directories = ["include"],
    visibility = ["PUBLIC"],
)

llvm_binary(
    name = "llvm-mipdata",
    srcs = glob([
        "tools/llvm-mipdata/*.cpp",
    ]),
    headers = glob([
        "tools/llvm-mipdata/*.h",
    ]),
    visibility = ["PUBLIC"],
    deps = [
        ":CodeGen",
        ":Core",
        ":Object",
        ":Support",
        ":Symbolize",
        ":TargetParser",
    ],
)
